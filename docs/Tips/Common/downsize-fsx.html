<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Tips/Common/downsize-fsx" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Downsize existing FSx Volume | AI on SageMaker HyperPod</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://awslabs.github.io/img/header_background.png"><meta data-rh="true" name="twitter:image" content="https://awslabs.github.io/img/header_background.png"><meta data-rh="true" property="og:url" content="https://awslabs.github.io/docs/Tips/Common/downsize-fsx"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="machine learning, generative ai, genai, sagemaker, hyperpod, SageMaker HyperPod,         model training, model inference, nemo framework, pytorch, pytorch framework"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Downsize existing FSx Volume | AI on SageMaker HyperPod"><meta data-rh="true" name="description" content="Instructions to downsize an existing FSxL Filesystem using DRA import/export"><meta data-rh="true" property="og:description" content="Instructions to downsize an existing FSxL Filesystem using DRA import/export"><link data-rh="true" rel="icon" href="/img/Amazon-Sagemaker-Icon.jpg"><link data-rh="true" rel="canonical" href="https://awslabs.github.io/docs/Tips/Common/downsize-fsx"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/docs/Tips/Common/downsize-fsx" hreflang="en"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/docs/Tips/Common/downsize-fsx" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tips","item":"https://awslabs.github.io/docs/category/tips"},{"@type":"ListItem","position":2,"name":"Downsize existing FSx Volume","item":"https://awslabs.github.io/docs/Tips/Common/downsize-fsx"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="AI on SageMaker HyperPod RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="AI on SageMaker HyperPod Atom Feed"><link rel="stylesheet" href="/assets/css/styles.3e9092dc.css">
<script src="/assets/js/runtime~main.020652ce.js" defer="defer"></script>
<script src="/assets/js/main.ad341d2a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/Amazon-Sagemaker-Icon.jpg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Amazon-Sagemaker-Icon.jpg" alt="AI on SageMaker HyperPod" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/Amazon-Sagemaker-Icon.jpg" alt="AI on SageMaker HyperPod" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AI on SageMaker HyperPod</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Orchestrated by EKS</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/orchestrated-by-eks/initial-cluster-setup">Initial cluster setup</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/trainium/aws-trainium">AWS Trainium</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/ddp/distributed-data-parallel">Distributed Data Parallel</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/fsdp/fully-sharded-data-parallel">Fully Sharded Data Parallel</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/megatron-lm/megatron-lm-readme">NVIDIA Megatron LM</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/ray-train/ray-train-readme">Ray Train</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Orchestrated by SLURM</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/orchestrated-by-slurm/initial-cluster-setup">Initial cluster setup</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/trainium/Llama3-70B">AWS Trainium</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/ddp/distributed-data-parallel">Distributed Data Parallel</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/fsdp/fully-sharded-data-parallel">Fully Sharded Data Parallel</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/megatron-lm/megatron-lm-readme">NVIDIA Megatron LM</a></li></ul></div><a class="navbar__item navbar__link" href="/resources">Useful links</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/awslabs/ai-on-sagemaker-hyperpod" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/eks-blueprints">EKS Blueprints</a><button aria-label="Expand sidebar category &#x27;EKS Blueprints&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/slurm-blueprints">SLURM Blueprints</a><button aria-label="Expand sidebar category &#x27;SLURM Blueprints&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/sagemaker-hyperpod-recipes">Sagemaker Hyperpod Recipes</a><button aria-label="Expand sidebar category &#x27;Sagemaker Hyperpod Recipes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/add-ons">Add-Ons</a><button aria-label="Expand sidebar category &#x27;Add-Ons&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/validation-and-testing">Validation and Testing</a><button aria-label="Expand sidebar category &#x27;Validation and Testing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/infrastructure-as-a-code">Infrastructure as a Code</a><button aria-label="Expand sidebar category &#x27;Infrastructure as a Code&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/tips">Tips</a><button aria-label="Collapse sidebar category &#x27;Tips&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/Tips/Common/link-fsx-to-S3">Common</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tips/Common/link-fsx-to-S3">Link FSx Filesystems to Amazon S3 (Data Repository Association)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tips/Common/mount-additional-fsx">Mount additional FSx Filesystem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Tips/Common/downsize-fsx">Downsize existing FSx Volume</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tips/Common/Fsx for Lustre best practices">FSx for Lustre Best practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tips/Common/Fsx for Lustre performance">FSx for Lustre performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tips/Common/Fsx for Lustre compression">FSx for Lustre compression</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tips/Common/move-files-s3">Upload files to Amazon s3</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/Tips/EKS/ssm-login">EKS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/Tips/Slurm/containers">Slurm</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/tips"><span>Tips</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Common</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Downsize existing FSx Volume</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Downsize existing FSx Volume</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="instructions-to-downsize-an-existing-fsxl-filesystem-using-dra-importexport">Instructions to downsize an existing FSxL Filesystem using DRA import/export<a href="#instructions-to-downsize-an-existing-fsxl-filesystem-using-dra-importexport" class="hash-link" aria-label="Direct link to Instructions to downsize an existing FSxL Filesystem using DRA import/export" title="Direct link to Instructions to downsize an existing FSxL Filesystem using DRA import/export">​</a></h3>
<p>These steps detail how to migrate from an existing FSxL filesystem to a smaller FSx FileSystem. There are several steps involved in this process, which uses FSxL DRA Export Policies to backup existing FileSystem to s3, then create a new FSxL Filesystem with a DRA Import policies to move old data to new FileSystem, and mount it to an existing Cluster. For more information, see the <a href="https://docs.aws.amazon.com/fsx/latest/LustreGuide/create-dra-linked-data-repo.html" target="_blank" rel="noopener noreferrer">FSx Lustre guide on linking your filesystem to S3 bucket </a>.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>You cannot downsize the storage size of an existing FSxL filesystem, hence the below method to migrate to a smaller FSxL filesystem is the alternative method</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-link-existing-filesystem-to-an-s3-bucket-in-your-account">1. Link existing filesystem to an S3 bucket in your account<a href="#1-link-existing-filesystem-to-an-s3-bucket-in-your-account" class="hash-link" aria-label="Direct link to 1. Link existing filesystem to an S3 bucket in your account" title="Direct link to 1. Link existing filesystem to an S3 bucket in your account">​</a></h4>
<p>It is recommended to create a new S3 bucket in the desired region of your destination filesystem for this purpose:</p>
<p>To create a new bucket using the cli:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws s3api create-bucket </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bucket</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">YOUR_DRA_BUCKET</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--region</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">AWS_REGION</span><span class="token operator">&gt;</span><span class="token plain"> --create-bucket-configuration LocationCons</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">traint</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token plain">AWS_REGION</span><span class="token operator">&gt;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-a-data-repository-association-for-your-existing-fsx">2. Create a Data Repository Association for your existing FSx<a href="#2-create-a-data-repository-association-for-your-existing-fsx" class="hash-link" aria-label="Direct link to 2. Create a Data Repository Association for your existing FSx" title="Direct link to 2. Create a Data Repository Association for your existing FSx">​</a></h4>
<p>In the FSx Lustre Console, go to your <strong>existing Filesystem &gt; Data Repository Assoications &gt; Create</strong>. Follow the below sample configuration:</p>
<p><img decoding="async" loading="lazy" alt="Users" src="/assets/images/DRA_Create-b466f4d0e5c58f457071e3c05887ae88.png" width="1042" height="1150" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Note: for filesystem path, it is recommended to set the root filesystem path of <code>/</code> to ensure the entire filesystem is included in the DRA policy.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-create-a-data-repository-export-task">3. Create a Data Repository Export Task<a href="#3-create-a-data-repository-export-task" class="hash-link" aria-label="Direct link to 3. Create a Data Repository Export Task" title="Direct link to 3. Create a Data Repository Export Task">​</a></h4>
<p>Once your Data Repositary association is created, create a data repository task for that DRA. Follow the below sample configuration:</p>
<p><img decoding="async" loading="lazy" alt="DRA Task Create" src="/assets/images/DRA_Task_Create-d914d8b9cccd17f308de9d003483e6c5.png" width="1378" height="522" class="img_ev3q"></p>
<p>Once created, you can view the status of your export task and view the Task status and total number of files processed by the task.</p>
<p><img decoding="async" loading="lazy" alt="DRA Task Status" src="/assets/images/DRA_task_status-5b957102f9d46d2355300c1fb0643d00.png" width="1506" height="853" class="img_ev3q"></p>
<p>When the task has reached a status of &quot;Succeeded&quot;, verify that the data has been successfully exported to your S3 bucket. You should see your root Filesystem directory stored in S3, similar to this example:</p>
<p><img decoding="async" loading="lazy" alt="S3 DRA" src="/assets/images/s3_dra-7adeae3f41fb1658a760f0b1dbefcd03.png" width="1401" height="476" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-create-a-new-fsx-filesystem-which-is-right-sized">4. Create a new FSx FileSystem which is right-sized:<a href="#4-create-a-new-fsx-filesystem-which-is-right-sized" class="hash-link" aria-label="Direct link to 4. Create a new FSx FileSystem which is right-sized:" title="Direct link to 4. Create a new FSx FileSystem which is right-sized:">​</a></h4>
<ul>
<li>Create file system for FSx - Persistent SSD, same configuration (VPC, Subnet, Security Group) as old FileSystem.</li>
<li>Create a DRA Import Policy targeting s3 bucket created in step 1</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="4a-create-file-system-for-fsx">4a. Create file system for FSx<a href="#4a-create-file-system-for-fsx" class="hash-link" aria-label="Direct link to 4a. Create file system for FSx" title="Direct link to 4a. Create file system for FSx">​</a></h5>
<p>Create new FSx Persistent or Scratch filesystem, ensure proper VPC, Subnet, Security Group -reference existing filesystem, SG can be same SG as HyperPod cluster nodes in SageMaker console.</p>
<p><img decoding="async" loading="lazy" alt="FSxL Config" src="/assets/images/FSxL_config-decec25dd67404e592e472335b50eebe.png" width="1376" height="666" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="4b-create-data-repostiory-association-for-your-new-fsxl-filesytem">4b. Create Data Repostiory Association for your new FSxL filesytem<a href="#4b-create-data-repostiory-association-for-your-new-fsxl-filesytem" class="hash-link" aria-label="Direct link to 4b. Create Data Repostiory Association for your new FSxL filesytem" title="Direct link to 4b. Create Data Repostiory Association for your new FSxL filesytem">​</a></h5>
<p>Create a DRA Import Policy (and optional export policy) for your new Filesystem. Ensure you specify the path to the S3 bucket which you have backed up your existing Filesystem.</p>
<p><img decoding="async" loading="lazy" alt="DRA Create 2" src="/assets/images/DRA-create-2-e6dcf46c73456c235c31d357f9fc291f.png" width="1228" height="1006" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-unmount-existing-fsxl-from-hyperpod-nodes">5. Unmount existing FSxL from HyperPod Nodes.<a href="#5-unmount-existing-fsxl-from-hyperpod-nodes" class="hash-link" aria-label="Direct link to 5. Unmount existing FSxL from HyperPod Nodes." title="Direct link to 5. Unmount existing FSxL from HyperPod Nodes.">​</a></h4>
<p>For reference, see <a href="https://docs.aws.amazon.com/fsx/latest/LustreGuide/unmounting-fs.html" target="_blank" rel="noopener noreferrer">FSx Lustre documentation for unmounting Filesystem</a>. Instructions also provided below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># on controller / login node of HyperPod cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Login as Root User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">su</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># cd to root directory </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#verify location as /root </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">pwd</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#should show /root</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>if you see the following error, you will need to logout of ubuntu user which is auto mounted on home directory</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@ip-10-1-79-94:~# umount /fsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">umount: /fsx: target is busy.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># $exit </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#sudo su </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#retry </span><br></span></code></pre></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-mount-new-fsxl-on-controller--login-nodes">6. Mount new FSxL on Controller / Login Nodes<a href="#6-mount-new-fsxl-on-controller--login-nodes" class="hash-link" aria-label="Direct link to 6. Mount new FSxL on Controller / Login Nodes" title="Direct link to 6. Mount new FSxL on Controller / Login Nodes">​</a></h4>
<p>Mount new FSxL on cluster controller / login node following commands in FSxL console. Run the command from FSxL console as root, once filesystem is successful. Note, we recommend waiting for the DRA task to execute successfully before continuing with this task.</p>
<p><img decoding="async" loading="lazy" alt="Mount FSx" src="/assets/images/mount-fsx-1-d1818c221390fe4029abf5ff5bd970fb.png" width="1604" height="906" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="7-unmount-fsx-from-the-compute-nodes-using-srun">7. Unmount /fsx from the compute nodes using srun<a href="#7-unmount-fsx-from-the-compute-nodes-using-srun" class="hash-link" aria-label="Direct link to 7. Unmount /fsx from the compute nodes using srun" title="Direct link to 7. Unmount /fsx from the compute nodes using srun">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">srun </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-N</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">NUM_COMPUTE_NODES</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">umount</span><span class="token plain"> /fsx</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="8-mount-new-filesystem-to-compute-nodes">8. Mount new filesystem to compute nodes<a href="#8-mount-new-filesystem-to-compute-nodes" class="hash-link" aria-label="Direct link to 8. Mount new filesystem to compute nodes" title="Direct link to 8. Mount new filesystem to compute nodes">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">srun </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-N</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">NUM_COMPUTE_NODES</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mount</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-t</span><span class="token plain"> lustre </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">command from FSxL console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="9-delete-old-fsx-lustre-filesystem">9. Delete old FSx Lustre Filesystem<a href="#9-delete-old-fsx-lustre-filesystem" class="hash-link" aria-label="Direct link to 9. Delete old FSx Lustre Filesystem" title="Direct link to 9. Delete old FSx Lustre Filesystem">​</a></h4>
<p>Once you have confirmed the new filesystem is mounted and you can read files from it, proceed with deleting the old FSx Filesystem</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="10-update-hyperpod-lifecycle-scripts-with-new-fsxl">10. Update HyperPod Lifecycle Scripts with new FSxL<a href="#10-update-hyperpod-lifecycle-scripts-with-new-fsxl" class="hash-link" aria-label="Direct link to 10. Update HyperPod Lifecycle Scripts with new FSxL" title="Direct link to 10. Update HyperPod Lifecycle Scripts with new FSxL">​</a></h4>
<p>Update <code>provisioning_parameters.json</code> file in your sagemaker lifecycle bucket with new FSxL DNS and Mount Name.</p>
<p><img decoding="async" loading="lazy" alt="Provisioning Parameters Update" src="/assets/images/prov_pram_update-069dc4651bd1d7a0c3e0163e01b37673.png" width="1072" height="634" class="img_ev3q"></p>
<p>Once updated, upload the new <code>provisioning_parameters.json</code> file to your s3 bucket in the lifecycle script directory to overwrite the old <code>provisioning_parameters.json</code> file. You can do so via the console (image below) or CLI.</p>
<p><img decoding="async" loading="lazy" alt="Upload to S3" src="/assets/images/upload-to-s3-cc3d8d200f547529488f96d4542e9f27.png" width="1478" height="747" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="11-optional--recommended-test-node-replacement">11. [Optional / Recommended] Test node replacement<a href="#11-optional--recommended-test-node-replacement" class="hash-link" aria-label="Direct link to 11. [Optional / Recommended] Test node replacement" title="Direct link to 11. [Optional / Recommended] Test node replacement">​</a></h4>
<p>After completing above steps, it is recommended to test that the new FSx Lustre defined in <code>provisioning_parameters.json</code> is mounted to new cluster nodes upon HyperPod replacement actions. You can trigger a manual node replacement from the head/controller node with the below command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> scontrol update </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">node</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token plain">NODE-IP</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">state</span><span class="token operator">=</span><span class="token plain">down </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">reason</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Action:Replace&quot;</span><br></span></code></pre></div></div>
<p>When the node comes back online, SSH into the node and confirm that FSx Lustre is properly mounted.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Tips/Common/mount-additional-fsx"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Mount additional FSx Filesystem</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Tips/Common/Fsx for Lustre best practices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FSx for Lustre Best practices</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#instructions-to-downsize-an-existing-fsxl-filesystem-using-dra-importexport" class="table-of-contents__link toc-highlight">Instructions to downsize an existing FSxL Filesystem using DRA import/export</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/orchestrated-by-eks/initial-cluster-setup">Orchestrated by EKS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/orchestrated-by-slurm/initial-cluster-setup">Orchestrated by SLURM</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Sites with Sagemaker AI content</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/aws-samples/awsome-distributed-training" target="_blank" rel="noopener noreferrer" class="footer__link-item">Awsome Distributed Training<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/aws/sagemaker-hyperpod-recipes" target="_blank" rel="noopener noreferrer" class="footer__link-item">SageMaker HyperPod Recipes<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Other AWS related sites</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://aws.training" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS Training &amp; Certification<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://aws.amazon.com/sagemaker/ai/hyperpod" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amazon SageMaker HyperPod<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://repost.aws" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS re:Post<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 AWS WWSO ML Frameworks team. Built with ❤️ at AWS.</div></div></div></footer></div>
</body>
</html>