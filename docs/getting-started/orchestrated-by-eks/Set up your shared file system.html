<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/orchestrated-by-eks/Set up your shared file system" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Set up your shared file system | AI on Sagemaker Hyperpod</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://awslabs.github.io/img/header_background.png"><meta data-rh="true" name="twitter:image" content="https://awslabs.github.io/img/header_background.png"><meta data-rh="true" property="og:url" content="https://awslabs.github.io/docs/getting-started/orchestrated-by-eks/Set up your shared file system"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="machine learning, generative ai, genai, sagemaker, hyperpod, sagemaker hyperpod,         model training, model inference, nemo framework, pytorch, pytorch framework"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Set up your shared file system | AI on Sagemaker Hyperpod"><meta data-rh="true" name="description" content="Install the Amazon FSx for Lustre CSI Driver"><meta data-rh="true" property="og:description" content="Install the Amazon FSx for Lustre CSI Driver"><link data-rh="true" rel="icon" href="/img/Amazon-Sagemaker-Icon.jpg"><link data-rh="true" rel="canonical" href="https://awslabs.github.io/docs/getting-started/orchestrated-by-eks/Set up your shared file system"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/docs/getting-started/orchestrated-by-eks/Set up your shared file system" hreflang="en"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/docs/getting-started/orchestrated-by-eks/Set up your shared file system" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Getting Started","item":"https://awslabs.github.io/docs/category/getting-started"},{"@type":"ListItem","position":2,"name":"Orchestrated by EKS","item":"https://awslabs.github.io/docs/category/orchestrated-by-eks"},{"@type":"ListItem","position":3,"name":"Set up your shared file system","item":"https://awslabs.github.io/docs/getting-started/orchestrated-by-eks/Set up your shared file system"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="AI on Sagemaker Hyperpod RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="AI on Sagemaker Hyperpod Atom Feed"><link rel="stylesheet" href="/assets/css/styles.acb24679.css">
<script src="/assets/js/runtime~main.f813b8bc.js" defer="defer"></script>
<script src="/assets/js/main.3593904c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/Amazon-Sagemaker-Icon.jpg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Amazon-Sagemaker-Icon.jpg" alt="AI on Sagemaker Hyperpod" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/Amazon-Sagemaker-Icon.jpg" alt="AI on Sagemaker Hyperpod" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AI on Sagemaker Hyperpod</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Orchestrated by EKS</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/orchestrated-by-eks/initial-cluster-setup">Initial cluster setup</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/trainium/aws-trainium">AWS Trainium</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/ddp/distributed-data-parallel">Distributed Data Parallel</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/fsdp/fully-sharded-data-parallel">Fully Sharded Data Parallel</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/megatron-lm/megatron-lm-readme">NVIDIA Megatron LM</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/ray-train/ray-train-readme">Ray Train</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Orchestrated by SLURM</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/orchestrated-by-slurm/initial-cluster-setup">Initial cluster setup</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/trainium/Llama3-70B">AWS Trainium</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/ddp/distributed-data-parallel">Distributed Data Parallel</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/fsdp/fully-sharded-data-parallel">Fully Sharded Data Parallel</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/megatron-lm/megatron-lm-readme">NVIDIA Megatron LM</a></li></ul></div><a class="navbar__item navbar__link" href="/resources">Useful links</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/awslabs/ai-on-sagemaker-hyperpod" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/getting-started">Getting Started</a><button aria-label="Collapse sidebar category &#x27;Getting Started&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/orchestrated-by-eks">Orchestrated by EKS</a><button aria-label="Collapse sidebar category &#x27;Orchestrated by EKS&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/orchestrated-by-eks/initial-cluster-setup">Creating your SageMaker HyperPod cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/orchestrated-by-eks/Reviewing the cluster console">Reviewing the cluster console</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/orchestrated-by-eks/sagemaker-studio-integration">SageMaker Studio Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/orchestrated-by-eks/Verifying cluster connection to EKS">Verifying cluster connection to EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/orchestrated-by-eks/additional-information">Additional Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/orchestrated-by-eks/Set up your shared file system">Set up your shared file system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/orchestrated-by-eks/Adding a Data Repository Assocation">Adding a Data Repository Association</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/orchestrated-by-eks/Set up an Amazon S3 mountpoint">Set up an Amazon S3 mountpoint</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/orchestrated-by-slurm">Orchestrated by SLURM</a><button aria-label="Expand sidebar category &#x27;Orchestrated by SLURM&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/install-pre-requisites">Installing the required tools</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/eks-blueprints">EKS Blueprints</a><button aria-label="Expand sidebar category &#x27;EKS Blueprints&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/slurm-blueprints">SLURM Blueprints</a><button aria-label="Expand sidebar category &#x27;SLURM Blueprints&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/sagemaker-hyperpod-recipes">Sagemaker Hyperpod Recipes</a><button aria-label="Expand sidebar category &#x27;Sagemaker Hyperpod Recipes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/add-ons">Add-Ons</a><button aria-label="Expand sidebar category &#x27;Add-Ons&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/validation-and-testing">Validation and Testing</a><button aria-label="Expand sidebar category &#x27;Validation and Testing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/infrastructure-as-a-code">Infrastructure as a Code</a><button aria-label="Expand sidebar category &#x27;Infrastructure as a Code&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tips">Tips</a><button aria-label="Expand sidebar category &#x27;Tips&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/getting-started"><span>Getting Started</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/orchestrated-by-eks"><span>Orchestrated by EKS</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Set up your shared file system</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Set up your shared file system</h1></header><h4 class="anchor anchorWithStickyNavbar_LWe7" id="install-the-amazon-fsx-for-lustre-csi-driver">Install the Amazon FSx for Lustre CSI Driver<a href="#install-the-amazon-fsx-for-lustre-csi-driver" class="hash-link" aria-label="Direct link to Install the Amazon FSx for Lustre CSI Driver" title="Direct link to Install the Amazon FSx for Lustre CSI Driver">​</a></h4>
<p>The <a href="https://github.com/kubernetes-sigs/aws-fsx-csi-driver" target="_blank" rel="noopener noreferrer">Amazon FSx for Lustre Container Storage Interface (CSI) driver</a> uses <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">IAM roles for service accounts (IRSA)</a> to authenticate AWS API calls. To use IRSA, an <a href="https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">IAM OpenID Connect (OIDC) provider</a> needs to be associated with the OIDC issuer URL that comes provisioned your EKS cluster.</p>
<blockquote>
<p><strong>Performance best practice:</strong>
Make sure that your file system is located in the same Region and Availability Zone as your compute nodes. Accessing a file system in a different Region or Availability Zone will result in reduced I/O performance and increased network costs.</p>
</blockquote>
<p>Create an IAM OIDC identity provider for your cluster with the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">eksctl utils associate-iam-oidc-provider --cluster $EKS_CLUSTER_NAME --approve</span><br></span></code></pre></div></div>
<p>Create a service account with an IAM role mapped to it for use with the FSx for Lustre CSI driver:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">eksctl create iamserviceaccount \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --name fsx-csi-controller-sa \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --namespace kube-system \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --cluster $EKS_CLUSTER_NAME \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --attach-policy-arn arn:aws:iam::aws:policy/AmazonFSxFullAccess \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --approve \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --role-name FSXLCSI-${EKS_CLUSTER_NAME}-${AWS_REGION} \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --region $AWS_REGION</span><br></span></code></pre></div></div>
<p>Verify proper annotation of the service account with the IAM role ARN:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get sa fsx-csi-controller-sa -n kube-system -oyaml </span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: ServiceAccount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    eks.amazonaws.com/role-arn: arn:aws:iam::012345678910:role/FSXLCSI-sagemaker-hyperpod-eks-cluster-us-west-2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  creationTimestamp: &quot;2025-06-05T15:17:19Z&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    app.kubernetes.io/managed-by: eksctl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: fsx-csi-controller-sa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  namespace: kube-system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  resourceVersion: &quot;43455&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uid: 514c9567-7021-469f-b700-6f55e3e9e864</span><br></span></code></pre></div></div>
<p>Deploy the FSx for Lustre CSI driver using Helm:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">helm repo add aws-fsx-csi-driver https://kubernetes-sigs.github.io/aws-fsx-csi-driver</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">helm upgrade --install aws-fsx-csi-driver aws-fsx-csi-driver/aws-fsx-csi-driver\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --namespace kube-system \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --set controller.serviceAccount.create=false</span><br></span></code></pre></div></div>
<p>Verify instillation of the FSx for Lustre CSI driver:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get pods -n kube-system -l app.kubernetes.io/name=aws-fsx-csi-driver</span><br></span></code></pre></div></div>
<hr>
<p>The <a href="https://github.com/kubernetes-sigs/aws-fsx-csi-driver" target="_blank" rel="noopener noreferrer">Amazon FSx for Lustre CSI driver</a> presents you with two options for provisioning a file system:</p>
<p><strong>Dynamic Provisioning</strong>: This option leverages Persistent Volume Claims (PVCs) in Kubernetes. You define a PVC with desired storage specifications. The CSI Driver automatically provisions the FSx file system for you based on the PVC request. This allows for easier scaling and eliminates the need to manually create file systems.</p>
<p><strong>Static Provisioning</strong>: In this method, you manually create the FSx file system before using the CSI Driver. You&#x27;ll need to configure details like subnet ID and security groups for the file system. Then, you can use the Driver to mount this pre-created file system within your container as a volume.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-provisioning">Dynamic Provisioning<a href="#dynamic-provisioning" class="hash-link" aria-label="Direct link to Dynamic Provisioning" title="Direct link to Dynamic Provisioning">​</a></h4>
<p>To dynamically provision an FSx for Lustre file system, start by creating a storage class that leverages the <code>fsx.csi.aws.com</code> provisioner:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat &lt;&lt;EOF&gt; storageclass.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: StorageClass</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: fsx-sc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">provisioner: fsx.csi.aws.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">parameters:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  subnetId: $PRIVATE_SUBNET_ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  securityGroupIds: $SECURITY_GROUP_ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  deploymentType: PERSISTENT_2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  automaticBackupRetentionDays: &quot;0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copyTagsToBackups: &quot;true&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  perUnitStorageThroughput: &quot;250&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dataCompressionType: &quot;LZ4&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  fileSystemTypeVersion: &quot;2.15&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mountOptions:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - flock</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply -f storageclass.yaml</span><br></span></code></pre></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Parameter Explanation</summary><div><div class="collapsibleContent_i85q"><ul>
<li>
<p><strong>privateSubnetId</strong> - The subnet ID that the FSx for Lustre filesystem should be created inside. Using the <code>$PRIVATE_SUBNET_ID</code> environment variable, we are referencing the same private subnet that was used for HyperPod cluster creation.</p>
</li>
<li>
<p><strong>securityGroupIds</strong> - A list of security group IDs that should be attached to the filesystem. Using the <code>$SECURITY_GROUP</code> environment variable, we are referencing the same security group that was use for HyperPod cluster creation.</p>
</li>
<li>
<p><strong>deploymentType</strong>: <code>PERSISTENT_2</code> is the latest generation of Persistent deployment type, and is best-suited for use cases that require longer-term storage, and have latency-sensitive workloads that require the highest levels of IOPS and throughput. For more information see <a href="https://docs.aws.amazon.com/fsx/latest/LustreGuide/using-fsx-lustre.html" target="_blank" rel="noopener noreferrer">Deployment options for FSx for Lustre file systems</a>.</p>
</li>
<li>
<p><strong>automaticBackupRetentionDays</strong>: The number of days to retain automatic backups. Setting this value to 0 disables the creation of automatic backups. If you set this parameter to a non-zero value, you can also specify the preferred time to take daily backups using the dailyAutomaticBackupStartTime parameter.</p>
</li>
<li>
<p><strong>copyTagsToBackups</strong>: If this value is true, all tags for the file system are copied to all automatic and user-initiated backups.</p>
</li>
<li>
<p><strong>perUnitStorageThroughput</strong>: For <code>PERSISTENT_2</code> deployments, you can specify the storage throughput in MBps per TiB of storage capacity.</p>
</li>
<li>
<p><strong>dataCompressionType</strong>: FSx for Lustre supports data compression via the LZ4 algorithm, which is optimized to deliver high levels of compression without adversely impacting file system performance. For more information see <a href="https://docs.aws.amazon.com/fsx/latest/LustreGuide/data-compression.html" target="_blank" rel="noopener noreferrer">Lustre data compression</a>.</p>
</li>
<li>
<p><strong>fileSystemTypeVersion</strong>: This sets the Lustre version for the FSx for Lustre file system that will be created.</p>
</li>
<li>
<p><strong>mountOptions</strong>: A list of mount options for the file system. The <code>flock</code> option mounts your file system with file lock enabled.</p>
</li>
</ul><p>You can find more information about storage class parameters in the <a href="https://github.com/kubernetes-sigs/aws-fsx-csi-driver/tree/master/examples/kubernetes/dynamic_provisioning#dynamic-provisioning-example" target="_blank" rel="noopener noreferrer">aws-fsx-csi-driver GitHub repository</a></p></div></div></details>
<p>Verify the <code>fsx-sc</code> storage class was created:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get sc fsx-sc -oyaml</span><br></span></code></pre></div></div>
<p>Next, create a persistent volume claim (PVC) that uses the <code>fsx-claim</code> storage claim:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat &lt;&lt;EOF&gt; pvc.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: fsx-claim</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    - ReadWriteMany</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  storageClassName: fsx-sc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      storage: 1200Gi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Note</strong>
PVCs are namespaced Kubernetes resources, so be sure to change the namespace as needed before creation.</p>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply -f pvc.yaml</span><br></span></code></pre></div></div>
<p>This PVC will kick off the dynamic provisioning of an FSx for Lustre file system based on the specifications provided in the storage class.</p>
<p>View the status of the PVC:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl describe pvc fsx-claim </span><br></span></code></pre></div></div>
<p>Check to see if the PVC is in a <code>Pending</code> or <code>Bound</code> state:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> kubectl get pvc fsx-claim  -n default  -ojson \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> | jq -r .status.phase</span><br></span></code></pre></div></div>
<p>Ensure that the status is set to <code>Bound</code> before deploying any pods that reference the persistent volume claim. The status may remain in a <code>Pending</code> state ( ~10 mins) while the file system is being provisioned.</p>
<p>Retrieve the associated FSx for Lustre volume ID:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get pv $(kubectl get pvc fsx-claim  -n default -ojson \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> | jq -r .spec.volumeName) -ojson \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> | jq -r .spec.csi.volumeHandle</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="static-provisioning-optional">Static Provisioning (Optional)<a href="#static-provisioning-optional" class="hash-link" aria-label="Direct link to Static Provisioning (Optional)" title="Direct link to Static Provisioning (Optional)">​</a></h4>
<p>Alternatively, if you prefer to deploy a standalone FSx for Lustre file system using AWS CloudFormation, click the button below:</p>
<p></p><div>Deploy the FSx for Lustre File System Stack</div><p></p>
<p>For the Security Group ID and Subnet ID in the network options, use the IDs available from the environment variables - <code>$SECURITY_GROUP</code>, and <code>$PRIVATE_SUBNET_ID</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="to-use-an-existing-fsxl-file-system-with-the-csi-driver-follow-the-below-steps">To use an existing FSxL File system with the CSI driver follow the below steps<a href="#to-use-an-existing-fsxl-file-system-with-the-csi-driver-follow-the-below-steps" class="hash-link" aria-label="Direct link to To use an existing FSxL File system with the CSI driver follow the below steps" title="Direct link to To use an existing FSxL File system with the CSI driver follow the below steps">​</a></h4>
<blockquote>
<p><strong>Note:</strong>
Before using an existing file system with the CSI driver on your EKS HyperPod cluster, please ensure that your FSx file system is in the same subnet (and thus, same Availability Zone) as your HyperPod cluster nodes.</p>
<p>You can check the subnet of your HyperPod nodes by checking the <code>$PRIVATE_SUBNET_ID</code> environment variable set as part of this cluster creation process.</p>
<p>To check the subnet ID of your existing file system, run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Replace fs-xxx with your file system id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws fsx describe-file-systems --file-system-id fs-xxx --query &#x27;FileSystems[0].SubnetIds[]&#x27; --output text</span><br></span></code></pre></div></div>
</blockquote>
<blockquote>
<p><strong>Note:</strong>
The following YAMLs require variables that are not in our env_vars. To retrieve the variables, you can find them in your AWS console in <code>FSx for Lustre</code> page, or you can run these commands:</p>
<p>FSx For Lustre ID:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws fsx describe-file-systems --region $AWS_REGION | jq -r &#x27;.FileSystems[0].FileSystemId&#x27;</span><br></span></code></pre></div></div>
<p>FSx DNS Name:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws fsx describe-file-systems --region $AWS_REGION --file-system-id &lt;fs-xxxx&gt; --query &#x27;FileSystems[0].DNSName&#x27; --output text</span><br></span></code></pre></div></div>
<p>FSx Mount Name:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws fsx describe-file-systems --region $AWS_REGION --file-system-id &lt;fs-xxxx&gt; --query &#x27;FileSystems[0].LustreConfiguration.MountName&#x27; --output text</span><br></span></code></pre></div></div>
</blockquote>
<ol>
<li>Create a StorageClass that references your existing FSx file system. Replace the fileSystemId, subnetId and securityGroupIDs in the yaml file accordingly.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat &lt;&lt;EOF&gt; storageclass.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: StorageClass</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: fsx-sc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">provisioner: fsx.csi.aws.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">parameters:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  fileSystemId: fs-xxxx # Replace with your FSx file system ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  subnetId: subnet-xxxx  # Replace with your subnet ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  securityGroupIds: $SECURITY_GROUP_ID  # Replace with your security group ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply -f storageclass.yaml</span><br></span></code></pre></div></div>
<ol start="2">
<li>Create a PersistentVolume (PV) that references your existing FSx volume. Replace the storage and volumeHandle parameters accordingly.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat &lt;&lt;EOF&gt; pv.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: PersistentVolume</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: fsx-pv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  capacity:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    storage: 1200Gi  # Adjust based on your FSx volume size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  volumeMode: Filesystem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    - ReadWriteMany</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  persistentVolumeReclaimPolicy: Retain</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  storageClassName: fsx-sc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  csi:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    driver: fsx.csi.aws.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumeHandle: fs-xxxxx  # Replace with your FSx file system ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumeAttributes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      dnsname: fs-xxxxx.fsx.region.amazonaws.com  # Replace with your FSx file system DNS name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      mountname: abc123  # Replace with your FSx file system mountname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply -f pv.yaml</span><br></span></code></pre></div></div>
<ol start="3">
<li>Create a PersistentVolumeClaim (PVC) to use the existing FSx volume. Verify if the storage parameter value matches the PV size created above.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat &lt;&lt;EOF&gt; pvc.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: fsx-claim</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    - ReadWriteMany</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  storageClassName: fsx-sc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      storage: 1200Gi  # Should match the PV size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply -f pvc.yaml</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mount-the-volume-to-container">Mount the volume to container<a href="#mount-the-volume-to-container" class="hash-link" aria-label="Direct link to Mount the volume to container" title="Direct link to Mount the volume to container">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat &lt;&lt;EOF&gt; pod.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: fsx-app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - name: app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: ubuntu</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    command: [&quot;/bin/sh&quot;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    args: [&quot;-c&quot;, &quot;while true; do echo $(date -u) &gt;&gt; /data/out.txt; sleep 5; done&quot;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumeMounts:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    - name: persistent-storage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      mountPath: /data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - name: persistent-storage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      claimName: fsx-claim</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply -f pod.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/getting-started/orchestrated-by-eks/additional-information"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Additional Information</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/getting-started/orchestrated-by-eks/Adding a Data Repository Assocation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Adding a Data Repository Association</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/orchestrated-by-eks/initial-cluster-setup">Orchestrated by EKS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/orchestrated-by-slurm/initial-cluster-setup">Orchestrated by SLURM</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Sites with Sagemaker AI content</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/aws-samples/awsome-distributed-training" target="_blank" rel="noopener noreferrer" class="footer__link-item">Awsome Distributed Training<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/aws/sagemaker-hyperpod-recipes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sagemaker Hyperpod Recipes<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Other AWS related sites</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://aws.training" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS Training &amp; Certification<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://aws.amazon.com/sagemaker/ai/hyperpod" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amazon Sagemaker Hyperpod<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://repost.aws" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS re:Post<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 AWS WWSO ML Frameworks team. Built with ❤️ at AWS.</div></div></div></footer></div>
</body>
</html>