<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-validation-and-testing/performance-testing/nccl-tests" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">NCCL Performance Tests | AI on SageMaker HyperPod</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://awslabs.github.io/img/header_background.png"><meta data-rh="true" name="twitter:image" content="https://awslabs.github.io/img/header_background.png"><meta data-rh="true" property="og:url" content="https://awslabs.github.io/docs/validation-and-testing/performance-testing/nccl-tests"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="machine learning, generative ai, genai, sagemaker, hyperpod, SageMaker HyperPod,         model training, model inference, nemo framework, pytorch, pytorch framework"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="NCCL Performance Tests | AI on SageMaker HyperPod"><meta data-rh="true" name="description" content="The NCCL Tests are a comprehensive testing suite that evaluates network performance between GPU instances using the NVIDIA Collective Communication Library. This is essential for validating cluster performance and troubleshooting issues before starting distributed training workloads."><meta data-rh="true" property="og:description" content="The NCCL Tests are a comprehensive testing suite that evaluates network performance between GPU instances using the NVIDIA Collective Communication Library. This is essential for validating cluster performance and troubleshooting issues before starting distributed training workloads."><link data-rh="true" rel="icon" href="/img/Amazon-Sagemaker-Icon.jpg"><link data-rh="true" rel="canonical" href="https://awslabs.github.io/docs/validation-and-testing/performance-testing/nccl-tests"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/docs/validation-and-testing/performance-testing/nccl-tests" hreflang="en"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/docs/validation-and-testing/performance-testing/nccl-tests" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Validation and Testing","item":"https://awslabs.github.io/docs/category/validation-and-testing"},{"@type":"ListItem","position":2,"name":"Performance Testing","item":"https://awslabs.github.io/docs/category/performance-testing"},{"@type":"ListItem","position":3,"name":"NCCL Performance Tests","item":"https://awslabs.github.io/docs/validation-and-testing/performance-testing/nccl-tests"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="AI on SageMaker HyperPod RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="AI on SageMaker HyperPod Atom Feed"><link rel="stylesheet" href="/assets/css/styles.12a8805c.css">
<script src="/assets/js/runtime~main.eac828a2.js" defer="defer"></script>
<script src="/assets/js/main.a07e3ef7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/Amazon-Sagemaker-Icon.jpg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Amazon-Sagemaker-Icon.jpg" alt="AI on SageMaker HyperPod" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/Amazon-Sagemaker-Icon.jpg" alt="AI on SageMaker HyperPod" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AI on SageMaker HyperPod</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Orchestrated by EKS</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/orchestrated-by-eks/initial-cluster-setup">Initial cluster setup</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/trainium/aws-trainium">AWS Trainium</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/ddp/distributed-data-parallel">Distributed Data Parallel</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/fsdp/fully-sharded-data-parallel">Fully Sharded Data Parallel</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/megatron-lm/megatron-lm-readme">NVIDIA Megatron LM</a></li><li><a class="dropdown__link" href="/docs/eks-blueprints/training/ray-train/ray-train-readme">Ray Train</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Orchestrated by SLURM</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/orchestrated-by-slurm/initial-cluster-setup">Initial cluster setup</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/trainium/Llama3-70B">AWS Trainium</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/ddp/distributed-data-parallel">Distributed Data Parallel</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/fsdp/fully-sharded-data-parallel">Fully Sharded Data Parallel</a></li><li><a class="dropdown__link" href="/docs/slurm-blueprints/training/megatron-lm/megatron-lm-readme">NVIDIA Megatron LM</a></li></ul></div><a class="navbar__item navbar__link" href="/resources">Useful links</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/awslabs/ai-on-sagemaker-hyperpod" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/eks-blueprints">EKS Blueprints</a><button aria-label="Expand sidebar category &#x27;EKS Blueprints&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/slurm-blueprints">SLURM Blueprints</a><button aria-label="Expand sidebar category &#x27;SLURM Blueprints&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/sagemaker-hyperpod-recipes">Sagemaker Hyperpod Recipes</a><button aria-label="Expand sidebar category &#x27;Sagemaker Hyperpod Recipes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/add-ons">Add-Ons</a><button aria-label="Expand sidebar category &#x27;Add-Ons&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/validation-and-testing">Validation and Testing</a><button aria-label="Collapse sidebar category &#x27;Validation and Testing&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/environment-validation">Environment Validation</a><button aria-label="Expand sidebar category &#x27;Environment Validation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/nccl--cuda-validation">NCCL &amp; CUDA Validation</a><button aria-label="Expand sidebar category &#x27;NCCL &amp; CUDA Validation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/performance-testing">Performance Testing</a><button aria-label="Collapse sidebar category &#x27;Performance Testing&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/validation-and-testing/performance-testing/nccl-tests">NCCL Performance Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation-and-testing/performance-testing/gpu-stress-testing">GPU Stress Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation-and-testing/performance-testing/nccom-tests">NCCOM Tests (Trainium)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/hyperpod-resiliency">HyperPod Resiliency</a><button aria-label="Expand sidebar category &#x27;HyperPod Resiliency&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/infrastructure-as-a-code">Infrastructure as a Code</a><button aria-label="Expand sidebar category &#x27;Infrastructure as a Code&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tips">Tips</a><button aria-label="Expand sidebar category &#x27;Tips&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/validation-and-testing"><span>Validation and Testing</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/performance-testing"><span>Performance Testing</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">NCCL Performance Tests</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>NCCL Performance Tests</h1></header>
<p>The <a href="https://github.com/NVIDIA/nccl-tests" target="_blank" rel="noopener noreferrer">NCCL Tests</a> are a comprehensive testing suite that evaluates network performance between GPU instances using the NVIDIA Collective Communication Library. This is essential for validating cluster performance and troubleshooting issues before starting distributed training workloads.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>NCCL Tests provide:</p>
<ul>
<li><strong>Network bandwidth validation</strong> between GPU instances</li>
<li><strong>Latency measurements</strong> for different collective operations</li>
<li><strong>Scalability testing</strong> across multiple nodes</li>
<li><strong>Performance baseline establishment</strong> for your cluster</li>
<li><strong>Hardware issue detection</strong> through systematic testing</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-expectations">Performance Expectations<a href="#performance-expectations" class="hash-link" aria-label="Direct link to Performance Expectations" title="Direct link to Performance Expectations">​</a></h3>
<p>Network performance varies by instance type:</p>
<ul>
<li><strong>p4d.24xlarge</strong>: 400 Gbps network bandwidth</li>
<li><strong>p5.48xlarge</strong>: 3200 Gbps network bandwidth</li>
<li><strong>p6e.48xlarge</strong>: 3200 Gbps network bandwidth</li>
<li><strong>trn1.32xlarge</strong>: 800 Gbps network bandwidth</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-slurm-clusters">For Slurm Clusters<a href="#for-slurm-clusters" class="hash-link" aria-label="Direct link to For Slurm Clusters" title="Direct link to For Slurm Clusters">​</a></h3>
<ul>
<li>Functional Slurm cluster with GPU nodes</li>
<li>Docker, <a href="https://github.com/NVIDIA/pyxis" target="_blank" rel="noopener noreferrer">Pyxis</a> and <a href="https://github.com/NVIDIA/enroot" target="_blank" rel="noopener noreferrer">Enroot</a> installed</li>
<li>Shared filesystem mounted (typically <code>/fsx</code>)</li>
<li>EFA drivers and AWS OFI NCCL installed</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-eks-clusters">For EKS Clusters<a href="#for-eks-clusters" class="hash-link" aria-label="Direct link to For EKS Clusters" title="Direct link to For EKS Clusters">​</a></h3>
<ul>
<li>Functional EKS cluster with GPU nodes</li>
<li>NVIDIA device plugin deployed</li>
<li>EFA device plugin deployed</li>
<li>Kubeflow MPI operator deployed</li>
<li>Container registry access (ECR)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="container-and-script-preparation">Container and Script Preparation<a href="#container-and-script-preparation" class="hash-link" aria-label="Direct link to Container and Script Preparation" title="Direct link to Container and Script Preparation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="get-nccl-tests-from-repository">Get NCCL Tests from Repository<a href="#get-nccl-tests-from-repository" class="hash-link" aria-label="Direct link to Get NCCL Tests from Repository" title="Direct link to Get NCCL Tests from Repository">​</a></h3>
<p>The NCCL tests are available in the <a href="https://github.com/aws-samples/awsome-distributed-training/tree/main/micro-benchmarks/nccl-tests" target="_blank" rel="noopener noreferrer">awsome-distributed-training repository</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Clone the repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone https://github.com/aws-samples/awsome-distributed-training.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> awsome-distributed-training/micro-benchmarks/nccl-tests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Available resources:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - nccl-tests.Dockerfile: Container build file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - slurm/: Slurm job scripts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - kubernetes/: Kubernetes manifests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - README.md: Detailed instructions</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-build-configuration">Container Build Configuration<a href="#container-build-configuration" class="hash-link" aria-label="Direct link to Container Build Configuration" title="Direct link to Container Build Configuration">​</a></h3>
<p>The repository includes a comprehensive <a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/nccl-tests.Dockerfile" target="_blank" rel="noopener noreferrer">NCCL-TESTS Dockerfile</a> with configurable versions:</p>
<table><thead><tr><th>Variable</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>GDRCOPY_VERSION</code></td><td>v2.5.1</td><td>GDRCopy version</td></tr><tr><td><code>EFA_INSTALLER_VERSION</code></td><td>1.43.2</td><td>EFA installer version</td></tr><tr><td><code>AWS_OFI_NCCL_VERSION</code></td><td>v1.16.3</td><td>AWS OFI NCCL version</td></tr><tr><td><code>NCCL_VERSION</code></td><td>v2.27.7-1</td><td>NCCL version</td></tr><tr><td><code>NCCL_TESTS_VERSION</code></td><td>v2.16.9</td><td>NCCL Tests version</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="slurm-implementation">Slurm Implementation<a href="#slurm-implementation" class="hash-link" aria-label="Direct link to Slurm Implementation" title="Direct link to Slurm Implementation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-build-and-prepare-container">1. Build and Prepare Container<a href="#1-build-and-prepare-container" class="hash-link" aria-label="Direct link to 1. Build and Prepare Container" title="Direct link to 1. Build and Prepare Container">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Build container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-t</span><span class="token plain"> nccl-tests:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${TAG}</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> nccl-tests.Dockerfile </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --build-arg</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;EFA_INSTALLER_VERSION=</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${EFA_INSTALLER_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --build-arg</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;AWS_OFI_NCCL_VERSION=</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${AWS_OFI_NCCL_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --build-arg</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;NCCL_VERSION=</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${NCCL_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --build-arg</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;NCCL_TESTS_VERSION=</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${NCCL_TESTS_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Convert to Enroot format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">enroot </span><span class="token function" style="color:rgb(80, 250, 123)">import</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-o</span><span class="token plain"> /fsx/nccl-tests.sqsh dockerd://nccl-tests:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${TAG}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-use-provided-slurm-job-scripts">2. Use Provided Slurm Job Scripts<a href="#2-use-provided-slurm-job-scripts" class="hash-link" aria-label="Direct link to 2. Use Provided Slurm Job Scripts" title="Direct link to 2. Use Provided Slurm Job Scripts">​</a></h3>
<p>The repository includes ready-to-use Slurm job scripts:</p>
<ul>
<li><strong><a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/nccl-tests-container.sbatch" target="_blank" rel="noopener noreferrer"><code>slurm/nccl-tests-container.sbatch</code></a></strong>: NCCL test using container</li>
<li><strong><a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/nccl-tests-ami.sbatch" target="_blank" rel="noopener noreferrer"><code>slurm/nccl-tests-ami.sbatch</code></a></strong>: Uses pre-installed NCCL from Deep Learning AMI</li>
</ul>
<p>For advanced topology-aware testing:</p>
<ul>
<li><strong><a href="https://github.com/aws-samples/awsome-distributed-training/tree/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests" target="_blank" rel="noopener noreferrer"><code>slurm/topology-aware-nccl-tests/</code></a></strong>: Advanced topology-aware NCCL tests with CSV export and automated submission scripts</li>
</ul>
<p>Key configuration options:</p>
<ul>
<li><strong>Node count</strong>: Modify <code>#SBATCH -N</code> parameter</li>
<li><strong>Container image</strong>: Set <code>IMAGE</code> variable path (for container version)</li>
<li><strong>Test parameters</strong>: Adjust <code>-b</code>, <code>-e</code>, <code>-f</code> flags for data size range</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-advanced-topology-aware-testing">3. Advanced Topology-Aware Testing<a href="#3-advanced-topology-aware-testing" class="hash-link" aria-label="Direct link to 3. Advanced Topology-Aware Testing" title="Direct link to 3. Advanced Topology-Aware Testing">​</a></h3>
<p>For comprehensive testing with topology awareness and result analysis, use the topology-aware scripts:</p>
<ul>
<li><strong><a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests/submit_nccl_test_container.sh" target="_blank" rel="noopener noreferrer"><code>submit_nccl_test_container.sh</code></a></strong>: Automated submission script for container-based tests</li>
<li><strong><a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests/submit_nccl_test_ami.sh" target="_blank" rel="noopener noreferrer"><code>submit_nccl_test_ami.sh</code></a></strong>: Automated submission script for AMI-based tests</li>
<li><strong><a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests/process_nccl_results.sh" target="_blank" rel="noopener noreferrer"><code>process_nccl_results.sh</code></a></strong>: Results processing and CSV export</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-run-tests">4. Run Tests<a href="#4-run-tests" class="hash-link" aria-label="Direct link to 4. Run Tests" title="Direct link to 4. Run Tests">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Navigate to the NCCL tests directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> awsome-distributed-training/micro-benchmarks/nccl-tests/slurm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Basic container test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sbatch nccl-tests-container.sbatch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Basic AMI test  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sbatch nccl-tests-ami.sbatch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Advanced topology-aware testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> topology-aware-nccl-tests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./submit_nccl_test_container.sh  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Follow prompts for configuration</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="eks-implementation">EKS Implementation<a href="#eks-implementation" class="hash-link" aria-label="Direct link to EKS Implementation" title="Direct link to EKS Implementation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-build-and-push-container">1. Build and Push Container<a href="#1-build-and-push-container" class="hash-link" aria-label="Direct link to 1. Build and Push Container" title="Direct link to 1. Build and Push Container">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Create ECR repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ECR_REPOSITORY_NAME</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;nccl-tests&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws ecr create-repository --repository-name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${ECR_REPOSITORY_NAME}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Get repository URI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">REPO_URI</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">aws ecr describe-repositories </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--query</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;repositories[?repositoryName==&#x27;</span><span class="token variable string variable" style="color:rgb(189, 147, 249);font-style:italic">${ECR_REPOSITORY_NAME}</span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&#x27;].repositoryUri&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--output</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> text</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ECR_URI</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${REPO_URI</span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">%</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">&quot;</span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${ECR_REPOSITORY_NAME}</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Build and push</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-t</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${REPO_URI}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${TAG}</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> nccl-tests.Dockerfile </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws ecr get-login-password </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> login </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--username</span><span class="token plain"> AWS --password-stdin </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${ECR_URI}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> push </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${REPO_URI}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${TAG}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-use-provided-kubernetes-manifests">2. Use Provided Kubernetes Manifests<a href="#2-use-provided-kubernetes-manifests" class="hash-link" aria-label="Direct link to 2. Use Provided Kubernetes Manifests" title="Direct link to 2. Use Provided Kubernetes Manifests">​</a></h3>
<p>The repository includes a ready-to-use Kubernetes manifest at <a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/kubernetes/nccl-tests.yaml" target="_blank" rel="noopener noreferrer"><code>kubernetes/nccl-tests.yaml</code></a>.</p>
<p>Key configuration parameters to adjust:</p>
<ul>
<li><strong><code>slotsPerWorker</code></strong>: Number of GPUs per node</li>
<li><strong><code>replicas</code></strong>: Number of worker nodes</li>
<li><strong><code>image</code></strong>: Container image URI</li>
<li><strong><code>nvidia.com/gpu</code></strong>: GPU resource requests</li>
<li><strong><code>vpc.amazonaws.com/efa</code></strong>: EFA adapter count</li>
<li><strong><code>node.kubernetes.io/instance-type</code></strong>: Target instance type</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-deploy-and-monitor">3. Deploy and Monitor<a href="#3-deploy-and-monitor" class="hash-link" aria-label="Direct link to 3. Deploy and Monitor" title="Direct link to 3. Deploy and Monitor">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Apply the MPIJob</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> nccl-tests-mpijob.yaml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Monitor job progress</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get mpijobs </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-w</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># View logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl logs </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">kubectl get pods </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-l</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> job-name</span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">nccl-tests </span><span class="token variable parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-o</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> name </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">|</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">grep</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> launcher</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Clean up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl delete mpijob nccl-tests</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-results">Understanding Results<a href="#understanding-results" class="hash-link" aria-label="Direct link to Understanding Results" title="Direct link to Understanding Results">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-output-analysis">Sample Output Analysis<a href="#sample-output-analysis" class="hash-link" aria-label="Direct link to Sample Output Analysis" title="Direct link to Sample Output Analysis">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># NCCL Test Results</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#       size         count      type   redop    root     time   algbw   busbw #wrong     time   algbw   busbw #wrong</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#        (B)    (elements)                               (us)  (GB/s)  (GB/s)            (us)  (GB/s)  (GB/s)       </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     1048576        262144     float     sum      -1   4607.6  233.04  436.95      0   4565.6  235.18  440.96      0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     2147483648     536870912     float     sum      -1   9197.5  233.49  437.79      0   9195.2  233.54  437.89      0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-metrics">Key Metrics<a href="#key-metrics" class="hash-link" aria-label="Direct link to Key Metrics" title="Direct link to Key Metrics">​</a></h3>
<ul>
<li><strong>algbw (Algorithm Bandwidth)</strong>: Data size / time</li>
<li><strong>busbw (Bus Bandwidth)</strong>: Reflects inter-GPU communication speed</li>
<li><strong>time</strong>: Time to complete the operation in microseconds</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-benchmarks">Performance Benchmarks<a href="#performance-benchmarks" class="hash-link" aria-label="Direct link to Performance Benchmarks" title="Direct link to Performance Benchmarks">​</a></h3>
<table><thead><tr><th>Instance Type</th><th>Expected Bus Bandwidth</th><th>Typical algbw (2GB)</th></tr></thead><tbody><tr><td>p4d.24xlarge</td><td>~300 GB/s</td><td>~200 GB/s</td></tr><tr><td>p5.48xlarge</td><td>~400+ GB/s</td><td>~230+ GB/s</td></tr><tr><td>p6e.48xlarge</td><td>~400+ GB/s</td><td>~250+ GB/s</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-and-diagnostics">Troubleshooting and Diagnostics<a href="#troubleshooting-and-diagnostics" class="hash-link" aria-label="Direct link to Troubleshooting and Diagnostics" title="Direct link to Troubleshooting and Diagnostics">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bad-node-detection">Bad Node Detection<a href="#bad-node-detection" class="hash-link" aria-label="Direct link to Bad Node Detection" title="Direct link to Bad Node Detection">​</a></h3>
<ol>
<li><strong>Run pairwise tests</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Test specific node pairs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sbatch </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-w</span><span class="token plain"> node1,node2 nccl-tests.sbatch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sbatch </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-w</span><span class="token plain"> node1,node3 nccl-tests.sbatch</span><br></span></code></pre></div></div>
<ol start="2">
<li><strong>Check for failed jobs</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sacct </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--format</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;JobID,JobName,State,ExitCode,NodeList&quot;</span><br></span></code></pre></div></div>
<ol start="3">
<li><strong>Isolate problematic nodes</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Test suspected bad node against known good node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sbatch </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-w</span><span class="token plain"> suspected-bad-node,known-good-node nccl-tests.sbatch</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-issues-and-solutions">Common Issues and Solutions<a href="#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions">​</a></h3>
<ol>
<li>
<p><strong>Low bandwidth performance</strong>:</p>
<ul>
<li>Check EFA interface configuration</li>
<li>Verify NCCL environment variables</li>
<li>Ensure proper GPU-EFA affinity</li>
</ul>
</li>
<li>
<p><strong>Test failures or hangs</strong>:</p>
<ul>
<li>Check NCCL_DEBUG output for errors</li>
<li>Verify network connectivity between nodes</li>
<li>Check for hardware issues</li>
</ul>
</li>
<li>
<p><strong>Inconsistent results</strong>:</p>
<ul>
<li>Run multiple iterations</li>
<li>Check for thermal throttling</li>
<li>Verify consistent cluster configuration</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimization">Performance Optimization<a href="#performance-optimization" class="hash-link" aria-label="Direct link to Performance Optimization" title="Direct link to Performance Optimization">​</a></h3>
<ol>
<li><strong>NCCL Environment Variables</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">NCCL_TREE_THRESHOLD</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">NCCL_ALGO</span><span class="token operator">=</span><span class="token plain">Ring,Tree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">NCCL_PROTO</span><span class="token operator">=</span><span class="token plain">Simple</span><br></span></code></pre></div></div>
<ol start="2">
<li><strong>EFA Optimization</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FI_EFA_USE_DEVICE_RDMA</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FI_EFA_FORK_SAFE</span><span class="token operator">=</span><span class="token number">1</span><br></span></code></pre></div></div>
<ol start="3">
<li><strong>GPU Affinity</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">0,1</span><span class="token plain">,2,3,4,5,6,7</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="result-analysis-and-processing">Result Analysis and Processing<a href="#result-analysis-and-processing" class="hash-link" aria-label="Direct link to Result Analysis and Processing" title="Direct link to Result Analysis and Processing">​</a></h2>
<p>The repository includes tools for analyzing NCCL test results:</p>
<ul>
<li><strong><a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/nccl_to_csv.py" target="_blank" rel="noopener noreferrer"><code>nccl_to_csv.py</code></a></strong>: Convert NCCL test output to CSV format</li>
<li><strong><a href="https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests/process_nccl_results.sh" target="_blank" rel="noopener noreferrer"><code>process_nccl_results.sh</code></a></strong>: Comprehensive result processing script</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage-example">Usage Example<a href="#usage-example" class="hash-link" aria-label="Direct link to Usage Example" title="Direct link to Usage Example">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Run NCCL test and process results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sbatch nccl-tests-container.sbatch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Convert output to CSV (after job completes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">python3 nccl_to_csv.py slurm-</span><span class="token operator">&lt;</span><span class="token plain">job-id</span><span class="token operator">&gt;</span><span class="token plain">.out </span><span class="token operator">&gt;</span><span class="token plain"> nccl_results.csv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># For topology-aware tests, use the automated processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> topology-aware-nccl-tests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./process_nccl_results.sh</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps">​</a></h2>
<p>After successful NCCL testing:</p>
<ol>
<li>Proceed to <a href="/docs/validation-and-testing/performance-testing/gpu-stress-testing">GPU stress testing</a></li>
<li>Run <a href="/docs/validation-and-testing/performance-testing/nccom-tests">Trainium NCCOM tests</a> if using Trainium instances</li>
<li>Set up <a href="/docs/add-ons/Observability">continuous monitoring</a> for ongoing performancelidation</li>
<li>Begin distributed training workloads with EKS or SLURM with confidence</li>
</ol></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/performance-testing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Performance Testing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/validation-and-testing/performance-testing/gpu-stress-testing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GPU Stress Testing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#performance-expectations" class="table-of-contents__link toc-highlight">Performance Expectations</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#for-slurm-clusters" class="table-of-contents__link toc-highlight">For Slurm Clusters</a></li><li><a href="#for-eks-clusters" class="table-of-contents__link toc-highlight">For EKS Clusters</a></li></ul></li><li><a href="#container-and-script-preparation" class="table-of-contents__link toc-highlight">Container and Script Preparation</a><ul><li><a href="#get-nccl-tests-from-repository" class="table-of-contents__link toc-highlight">Get NCCL Tests from Repository</a></li><li><a href="#container-build-configuration" class="table-of-contents__link toc-highlight">Container Build Configuration</a></li></ul></li><li><a href="#slurm-implementation" class="table-of-contents__link toc-highlight">Slurm Implementation</a><ul><li><a href="#1-build-and-prepare-container" class="table-of-contents__link toc-highlight">1. Build and Prepare Container</a></li><li><a href="#2-use-provided-slurm-job-scripts" class="table-of-contents__link toc-highlight">2. Use Provided Slurm Job Scripts</a></li><li><a href="#3-advanced-topology-aware-testing" class="table-of-contents__link toc-highlight">3. Advanced Topology-Aware Testing</a></li><li><a href="#4-run-tests" class="table-of-contents__link toc-highlight">4. Run Tests</a></li></ul></li><li><a href="#eks-implementation" class="table-of-contents__link toc-highlight">EKS Implementation</a><ul><li><a href="#1-build-and-push-container" class="table-of-contents__link toc-highlight">1. Build and Push Container</a></li><li><a href="#2-use-provided-kubernetes-manifests" class="table-of-contents__link toc-highlight">2. Use Provided Kubernetes Manifests</a></li><li><a href="#3-deploy-and-monitor" class="table-of-contents__link toc-highlight">3. Deploy and Monitor</a></li></ul></li><li><a href="#understanding-results" class="table-of-contents__link toc-highlight">Understanding Results</a><ul><li><a href="#sample-output-analysis" class="table-of-contents__link toc-highlight">Sample Output Analysis</a></li><li><a href="#key-metrics" class="table-of-contents__link toc-highlight">Key Metrics</a></li><li><a href="#performance-benchmarks" class="table-of-contents__link toc-highlight">Performance Benchmarks</a></li></ul></li><li><a href="#troubleshooting-and-diagnostics" class="table-of-contents__link toc-highlight">Troubleshooting and Diagnostics</a><ul><li><a href="#bad-node-detection" class="table-of-contents__link toc-highlight">Bad Node Detection</a></li><li><a href="#common-issues-and-solutions" class="table-of-contents__link toc-highlight">Common Issues and Solutions</a></li><li><a href="#performance-optimization" class="table-of-contents__link toc-highlight">Performance Optimization</a></li></ul></li><li><a href="#result-analysis-and-processing" class="table-of-contents__link toc-highlight">Result Analysis and Processing</a><ul><li><a href="#usage-example" class="table-of-contents__link toc-highlight">Usage Example</a></li></ul></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/orchestrated-by-eks/initial-cluster-setup">Orchestrated by EKS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/orchestrated-by-slurm/initial-cluster-setup">Orchestrated by SLURM</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Sites with Sagemaker AI content</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/aws-samples/awsome-distributed-training" target="_blank" rel="noopener noreferrer" class="footer__link-item">Awsome Distributed Training<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/aws/sagemaker-hyperpod-recipes" target="_blank" rel="noopener noreferrer" class="footer__link-item">SageMaker HyperPod Recipes<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Other AWS related sites</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://aws.training" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS Training &amp; Certification<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://aws.amazon.com/sagemaker/ai/hyperpod" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amazon SageMaker HyperPod<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://repost.aws" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS re:Post<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 AWS WWSO ML Frameworks team. Built with ❤️ at AWS.</div></div></div></footer></div>
</body>
</html>