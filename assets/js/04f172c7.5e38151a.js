"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9905],{1986:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"Tips/Common/link-fsx-to-S3","title":"Link FSx Filesystems to Amazon S3 (Data Repository Association)","description":"Using AWS Console","source":"@site/docs/08-Tips/Common/12-link-fsx-to-S3.md","sourceDirName":"08-Tips/Common","slug":"/Tips/Common/link-fsx-to-S3","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/Common/link-fsx-to-S3","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"title":"Link FSx Filesystems to Amazon S3 (Data Repository Association)","weight":52},"sidebar":"tutorialSidebar","previous":{"title":"Tips","permalink":"/ai-on-sagemaker-hyperpod/docs/category/tips"},"next":{"title":"Mount additional FSx Filesystem","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/Common/mount-additional-fsx"}}');var o=s(4848),i=s(8453);const a={title:"Link FSx Filesystems to Amazon S3 (Data Repository Association)",weight:52},r=void 0,c={},l=[{value:"Using AWS Console",id:"using-aws-console",level:2},{value:"Using AWS CLI",id:"using-aws-cli",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"using-aws-console",children:"Using AWS Console"}),"\n",(0,o.jsx)(t.p,{children:"Once a filesystem has been created in Amazon FSx, you can now link it to an S3 Bucket. This allows you to sync data back and forth between the filesystem and S3. It also allows you to delete the filesystem and preserve it\u2019s content on S3."}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Navigate to the ",(0,o.jsx)(t.a,{href:"https://console.aws.amazon.com/fsx/home",children:"FSx Console"})," > Filesystem > Data repositories > Click Create data repository association."]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Create DRA",src:s(9130).A+"",width:"2648",height:"574"})}),"\n",(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsx)(t.li,{children:"Link to an S3 bucket in the same region:"}),"\n"]}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"Field"}),(0,o.jsx)(t.th,{children:"Description"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"Filesystem Path"}),(0,o.jsxs)(t.td,{children:["Path of the FSx Filesystem to sync back to S3 i.e. ",(0,o.jsx)(t.code,{children:"/"})]})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"Data Repository Path"}),(0,o.jsxs)(t.td,{children:["Path on S3 to store synced content i.e. ",(0,o.jsx)(t.code,{children:"s3://bucket"})]})]})]})]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Link DRA",src:s(3830).A+"",width:"2004",height:"672"})}),"\n",(0,o.jsxs)(t.ol,{start:"3",children:["\n",(0,o.jsx)(t.li,{children:"Now you can select your import & export settings:"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"DRA Import / Export",src:s(8202).A+"",width:"1642",height:"820"})}),"\n",(0,o.jsx)(t.h2,{id:"using-aws-cli",children:"Using AWS CLI"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Before creating the association, make sure that the following environmental variables are defined in your terminal environment:"}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"export FSX_ID=YOUR_FSX_ID\nexport AWS_REGION=YOUR_FSX_REGION\nexport S3_BUCKET=YOUR_S3_BUCKET_NAME\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsx)(t.li,{children:"Now, create a data repository association between your S3 bucket and your FSx for Lustre Filesystem. Before doing this step, please make sure that your FSx Lustre Filesystem is created and available in the region of your preference."}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"aws fsx create-data-repository-association \\\n    --file-system-id ${FSX_ID} \\\n    --file-system-path \"/hsmtest\" \\\n    --data-repository-path s3://${S3_BUCKET} \\\n    --s3 AutoImportPolicy='{Events=[NEW,CHANGED,DELETED]},AutoExportPolicy={Events=[NEW,CHANGED,DELETED]}' \\\n    --batch-import-meta-data-on-create \\\n    --region ${AWS_REGION}\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"3",children:["\n",(0,o.jsx)(t.li,{children:"You can query the status of the data repository association creation process as below:"}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'aws fsx describe-data-repository-associations --filters "Name=file-system-id,Values=${FSX_ID}" --query "Associations[0].Lifecycle" --output text\n'})}),"\n",(0,o.jsxs)(t.p,{children:["The status is going to be changed from ",(0,o.jsx)(t.code,{children:"CREATING"})," to ",(0,o.jsx)(t.code,{children:"AVAILABLE"})," once the process is finished. It is expected to take few minutes for the process to create the association."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},3830:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/link-dra-fa4e93345d43284aaf9be33e6d004a3d.png"},8202:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/import-export-3b5f9869038860420781eb998fe6b331.png"},8453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>r});var n=s(6540);const o={},i=n.createContext(o);function a(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(i.Provider,{value:t},e.children)}},9130:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/create-dra-26c9b765ee5dee12297f03be0a6fc4fd.png"}}]);