"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7466],{8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>c});var i=n(6540);const t={},r=i.createContext(t);function l(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:s},e.children)}},9609:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"validation-and-testing/performance-testing/nccl-tests","title":"NCCL Performance Tests","description":"The NCCL Tests are a comprehensive testing suite that evaluates network performance between GPU instances using the NVIDIA Collective Communication Library. This is essential for validating cluster performance and troubleshooting issues before starting distributed training workloads.","source":"@site/docs/06-validation-and-testing/performance-testing/nccl-tests.md","sourceDirName":"06-validation-and-testing/performance-testing","slug":"/validation-and-testing/performance-testing/nccl-tests","permalink":"/docs/validation-and-testing/performance-testing/nccl-tests","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"NCCL Performance Tests","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Performance Testing","permalink":"/docs/category/performance-testing"},"next":{"title":"GPU Stress Testing","permalink":"/docs/validation-and-testing/performance-testing/gpu-stress-testing"}}');var t=n(4848),r=n(8453);const l={title:"NCCL Performance Tests",sidebar_position:1},c="NCCL Performance Tests",o={},d=[{value:"Overview",id:"overview",level:2},{value:"Performance Expectations",id:"performance-expectations",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"For Slurm Clusters",id:"for-slurm-clusters",level:3},{value:"For EKS Clusters",id:"for-eks-clusters",level:3},{value:"Container and Script Preparation",id:"container-and-script-preparation",level:2},{value:"Get NCCL Tests from Repository",id:"get-nccl-tests-from-repository",level:3},{value:"Container Build Configuration",id:"container-build-configuration",level:3},{value:"Slurm Implementation",id:"slurm-implementation",level:2},{value:"1. Build and Prepare Container",id:"1-build-and-prepare-container",level:3},{value:"2. Use Provided Slurm Job Scripts",id:"2-use-provided-slurm-job-scripts",level:3},{value:"3. Advanced Topology-Aware Testing",id:"3-advanced-topology-aware-testing",level:3},{value:"4. Run Tests",id:"4-run-tests",level:3},{value:"EKS Implementation",id:"eks-implementation",level:2},{value:"1. Build and Push Container",id:"1-build-and-push-container",level:3},{value:"2. Use Provided Kubernetes Manifests",id:"2-use-provided-kubernetes-manifests",level:3},{value:"3. Deploy and Monitor",id:"3-deploy-and-monitor",level:3},{value:"Understanding Results",id:"understanding-results",level:2},{value:"Sample Output Analysis",id:"sample-output-analysis",level:3},{value:"Key Metrics",id:"key-metrics",level:3},{value:"Performance Benchmarks",id:"performance-benchmarks",level:3},{value:"Troubleshooting and Diagnostics",id:"troubleshooting-and-diagnostics",level:2},{value:"Bad Node Detection",id:"bad-node-detection",level:3},{value:"Common Issues and Solutions",id:"common-issues-and-solutions",level:3},{value:"Performance Optimization",id:"performance-optimization",level:3},{value:"Result Analysis and Processing",id:"result-analysis-and-processing",level:2},{value:"Usage Example",id:"usage-example",level:3},{value:"Next Steps",id:"next-steps",level:2}];function a(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"nccl-performance-tests",children:"NCCL Performance Tests"})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.a,{href:"https://github.com/NVIDIA/nccl-tests",children:"NCCL Tests"})," are a comprehensive testing suite that evaluates network performance between GPU instances using the NVIDIA Collective Communication Library. This is essential for validating cluster performance and troubleshooting issues before starting distributed training workloads."]}),"\n",(0,t.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(s.p,{children:"NCCL Tests provide:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Network bandwidth validation"})," between GPU instances"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Latency measurements"})," for different collective operations"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Scalability testing"})," across multiple nodes"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Performance baseline establishment"})," for your cluster"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Hardware issue detection"})," through systematic testing"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"performance-expectations",children:"Performance Expectations"}),"\n",(0,t.jsx)(s.p,{children:"Network performance varies by instance type:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"p4d.24xlarge"}),": 400 Gbps network bandwidth"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"p5.48xlarge"}),": 3200 Gbps network bandwidth"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"p6e.48xlarge"}),": 3200 Gbps network bandwidth"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"trn1.32xlarge"}),": 800 Gbps network bandwidth"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(s.h3,{id:"for-slurm-clusters",children:"For Slurm Clusters"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Functional Slurm cluster with GPU nodes"}),"\n",(0,t.jsxs)(s.li,{children:["Docker, ",(0,t.jsx)(s.a,{href:"https://github.com/NVIDIA/pyxis",children:"Pyxis"})," and ",(0,t.jsx)(s.a,{href:"https://github.com/NVIDIA/enroot",children:"Enroot"})," installed"]}),"\n",(0,t.jsxs)(s.li,{children:["Shared filesystem mounted (typically ",(0,t.jsx)(s.code,{children:"/fsx"}),")"]}),"\n",(0,t.jsx)(s.li,{children:"EFA drivers and AWS OFI NCCL installed"}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"for-eks-clusters",children:"For EKS Clusters"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Functional EKS cluster with GPU nodes"}),"\n",(0,t.jsx)(s.li,{children:"NVIDIA device plugin deployed"}),"\n",(0,t.jsx)(s.li,{children:"EFA device plugin deployed"}),"\n",(0,t.jsx)(s.li,{children:"Kubeflow MPI operator deployed"}),"\n",(0,t.jsx)(s.li,{children:"Container registry access (ECR)"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"container-and-script-preparation",children:"Container and Script Preparation"}),"\n",(0,t.jsx)(s.h3,{id:"get-nccl-tests-from-repository",children:"Get NCCL Tests from Repository"}),"\n",(0,t.jsxs)(s.p,{children:["The NCCL tests are available in the ",(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/tree/main/micro-benchmarks/nccl-tests",children:"awsome-distributed-training repository"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Clone the repository\ngit clone https://github.com/aws-samples/awsome-distributed-training.git\ncd awsome-distributed-training/micro-benchmarks/nccl-tests\n\n# Available resources:\n# - nccl-tests.Dockerfile: Container build file\n# - slurm/: Slurm job scripts\n# - kubernetes/: Kubernetes manifests\n# - README.md: Detailed instructions\n"})}),"\n",(0,t.jsx)(s.h3,{id:"container-build-configuration",children:"Container Build Configuration"}),"\n",(0,t.jsxs)(s.p,{children:["The repository includes a comprehensive ",(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/nccl-tests.Dockerfile",children:"NCCL-TESTS Dockerfile"})," with configurable versions:"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Variable"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"GDRCOPY_VERSION"})}),(0,t.jsx)(s.td,{children:"v2.5.1"}),(0,t.jsx)(s.td,{children:"GDRCopy version"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"EFA_INSTALLER_VERSION"})}),(0,t.jsx)(s.td,{children:"1.43.2"}),(0,t.jsx)(s.td,{children:"EFA installer version"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"AWS_OFI_NCCL_VERSION"})}),(0,t.jsx)(s.td,{children:"v1.16.3"}),(0,t.jsx)(s.td,{children:"AWS OFI NCCL version"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"NCCL_VERSION"})}),(0,t.jsx)(s.td,{children:"v2.27.7-1"}),(0,t.jsx)(s.td,{children:"NCCL version"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"NCCL_TESTS_VERSION"})}),(0,t.jsx)(s.td,{children:"v2.16.9"}),(0,t.jsx)(s.td,{children:"NCCL Tests version"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"slurm-implementation",children:"Slurm Implementation"}),"\n",(0,t.jsx)(s.h3,{id:"1-build-and-prepare-container",children:"1. Build and Prepare Container"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'# Build container\ndocker build -t nccl-tests:${TAG} -f nccl-tests.Dockerfile \\\n    --build-arg="EFA_INSTALLER_VERSION=${EFA_INSTALLER_VERSION}" \\\n    --build-arg="AWS_OFI_NCCL_VERSION=${AWS_OFI_NCCL_VERSION}" \\\n    --build-arg="NCCL_VERSION=${NCCL_VERSION}" \\\n    --build-arg="NCCL_TESTS_VERSION=${NCCL_TESTS_VERSION}" \\\n    .\n\n# Convert to Enroot format\nenroot import -o /fsx/nccl-tests.sqsh dockerd://nccl-tests:${TAG}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"2-use-provided-slurm-job-scripts",children:"2. Use Provided Slurm Job Scripts"}),"\n",(0,t.jsx)(s.p,{children:"The repository includes ready-to-use Slurm job scripts:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/nccl-tests-container.sbatch",children:(0,t.jsx)(s.code,{children:"slurm/nccl-tests-container.sbatch"})})}),": NCCL test using container"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/nccl-tests-ami.sbatch",children:(0,t.jsx)(s.code,{children:"slurm/nccl-tests-ami.sbatch"})})}),": Uses pre-installed NCCL from Deep Learning AMI"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"For advanced topology-aware testing:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/tree/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests",children:(0,t.jsx)(s.code,{children:"slurm/topology-aware-nccl-tests/"})})}),": Advanced topology-aware NCCL tests with CSV export and automated submission scripts"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Key configuration options:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Node count"}),": Modify ",(0,t.jsx)(s.code,{children:"#SBATCH -N"})," parameter"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Container image"}),": Set ",(0,t.jsx)(s.code,{children:"IMAGE"})," variable path (for container version)"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Test parameters"}),": Adjust ",(0,t.jsx)(s.code,{children:"-b"}),", ",(0,t.jsx)(s.code,{children:"-e"}),", ",(0,t.jsx)(s.code,{children:"-f"})," flags for data size range"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"3-advanced-topology-aware-testing",children:"3. Advanced Topology-Aware Testing"}),"\n",(0,t.jsx)(s.p,{children:"For comprehensive testing with topology awareness and result analysis, use the topology-aware scripts:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests/submit_nccl_test_container.sh",children:(0,t.jsx)(s.code,{children:"submit_nccl_test_container.sh"})})}),": Automated submission script for container-based tests"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests/submit_nccl_test_ami.sh",children:(0,t.jsx)(s.code,{children:"submit_nccl_test_ami.sh"})})}),": Automated submission script for AMI-based tests"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests/process_nccl_results.sh",children:(0,t.jsx)(s.code,{children:"process_nccl_results.sh"})})}),": Results processing and CSV export"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"4-run-tests",children:"4. Run Tests"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Navigate to the NCCL tests directory\ncd awsome-distributed-training/micro-benchmarks/nccl-tests/slurm\n\n# Basic container test\nsbatch nccl-tests-container.sbatch\n\n# Basic AMI test  \nsbatch nccl-tests-ami.sbatch\n\n# Advanced topology-aware testing\ncd topology-aware-nccl-tests\n./submit_nccl_test_container.sh  # Follow prompts for configuration\n"})}),"\n",(0,t.jsx)(s.h2,{id:"eks-implementation",children:"EKS Implementation"}),"\n",(0,t.jsx)(s.h3,{id:"1-build-and-push-container",children:"1. Build and Push Container"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'# Create ECR repository\nECR_REPOSITORY_NAME="nccl-tests"\naws ecr create-repository --repository-name ${ECR_REPOSITORY_NAME}\n\n# Get repository URI\nREPO_URI=$(aws ecr describe-repositories --query "repositories[?repositoryName==\'${ECR_REPOSITORY_NAME}\'].repositoryUri" --output text)\nECR_URI=${REPO_URI%"/${ECR_REPOSITORY_NAME}"}\n\n# Build and push\ndocker build -t ${REPO_URI}:${TAG} -f nccl-tests.Dockerfile .\naws ecr get-login-password | docker login --username AWS --password-stdin ${ECR_URI}\ndocker push ${REPO_URI}:${TAG}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"2-use-provided-kubernetes-manifests",children:"2. Use Provided Kubernetes Manifests"}),"\n",(0,t.jsxs)(s.p,{children:["The repository includes a ready-to-use Kubernetes manifest at ",(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/kubernetes/nccl-tests.yaml",children:(0,t.jsx)(s.code,{children:"kubernetes/nccl-tests.yaml"})}),"."]}),"\n",(0,t.jsx)(s.p,{children:"Key configuration parameters to adjust:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"slotsPerWorker"})}),": Number of GPUs per node"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"replicas"})}),": Number of worker nodes"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"image"})}),": Container image URI"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"nvidia.com/gpu"})}),": GPU resource requests"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"vpc.amazonaws.com/efa"})}),": EFA adapter count"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"node.kubernetes.io/instance-type"})}),": Target instance type"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"3-deploy-and-monitor",children:"3. Deploy and Monitor"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Apply the MPIJob\nkubectl apply -f nccl-tests-mpijob.yaml\n\n# Monitor job progress\nkubectl get mpijobs -w\n\n# View logs\nkubectl logs -f $(kubectl get pods -l job-name=nccl-tests -o name | grep launcher)\n\n# Clean up\nkubectl delete mpijob nccl-tests\n"})}),"\n",(0,t.jsx)(s.h2,{id:"understanding-results",children:"Understanding Results"}),"\n",(0,t.jsx)(s.h3,{id:"sample-output-analysis",children:"Sample Output Analysis"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"# NCCL Test Results\n#       size         count      type   redop    root     time   algbw   busbw #wrong     time   algbw   busbw #wrong\n#        (B)    (elements)                               (us)  (GB/s)  (GB/s)            (us)  (GB/s)  (GB/s)       \n     1048576        262144     float     sum      -1   4607.6  233.04  436.95      0   4565.6  235.18  440.96      0\n     2147483648     536870912     float     sum      -1   9197.5  233.49  437.79      0   9195.2  233.54  437.89      0\n"})}),"\n",(0,t.jsx)(s.h3,{id:"key-metrics",children:"Key Metrics"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"algbw (Algorithm Bandwidth)"}),": Data size / time"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"busbw (Bus Bandwidth)"}),": Reflects inter-GPU communication speed"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"time"}),": Time to complete the operation in microseconds"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"performance-benchmarks",children:"Performance Benchmarks"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Instance Type"}),(0,t.jsx)(s.th,{children:"Expected Bus Bandwidth"}),(0,t.jsx)(s.th,{children:"Typical algbw (2GB)"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"p4d.24xlarge"}),(0,t.jsx)(s.td,{children:"~300 GB/s"}),(0,t.jsx)(s.td,{children:"~200 GB/s"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"p5.48xlarge"}),(0,t.jsx)(s.td,{children:"~400+ GB/s"}),(0,t.jsx)(s.td,{children:"~230+ GB/s"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"p6e.48xlarge"}),(0,t.jsx)(s.td,{children:"~400+ GB/s"}),(0,t.jsx)(s.td,{children:"~250+ GB/s"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"troubleshooting-and-diagnostics",children:"Troubleshooting and Diagnostics"}),"\n",(0,t.jsx)(s.h3,{id:"bad-node-detection",children:"Bad Node Detection"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Run pairwise tests"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Test specific node pairs\nsbatch -w node1,node2 nccl-tests.sbatch\nsbatch -w node1,node3 nccl-tests.sbatch\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Check for failed jobs"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'sacct --format "JobID,JobName,State,ExitCode,NodeList"\n'})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Isolate problematic nodes"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Test suspected bad node against known good node\nsbatch -w suspected-bad-node,known-good-node nccl-tests.sbatch\n"})}),"\n",(0,t.jsx)(s.h3,{id:"common-issues-and-solutions",children:"Common Issues and Solutions"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Low bandwidth performance"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Check EFA interface configuration"}),"\n",(0,t.jsx)(s.li,{children:"Verify NCCL environment variables"}),"\n",(0,t.jsx)(s.li,{children:"Ensure proper GPU-EFA affinity"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Test failures or hangs"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Check NCCL_DEBUG output for errors"}),"\n",(0,t.jsx)(s.li,{children:"Verify network connectivity between nodes"}),"\n",(0,t.jsx)(s.li,{children:"Check for hardware issues"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Inconsistent results"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Run multiple iterations"}),"\n",(0,t.jsx)(s.li,{children:"Check for thermal throttling"}),"\n",(0,t.jsx)(s.li,{children:"Verify consistent cluster configuration"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"NCCL Environment Variables"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"export NCCL_TREE_THRESHOLD=0\nexport NCCL_ALGO=Ring,Tree\nexport NCCL_PROTO=Simple\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"EFA Optimization"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"export FI_EFA_USE_DEVICE_RDMA=1\nexport FI_EFA_FORK_SAFE=1\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"GPU Affinity"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7\n"})}),"\n",(0,t.jsx)(s.h2,{id:"result-analysis-and-processing",children:"Result Analysis and Processing"}),"\n",(0,t.jsx)(s.p,{children:"The repository includes tools for analyzing NCCL test results:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/nccl_to_csv.py",children:(0,t.jsx)(s.code,{children:"nccl_to_csv.py"})})}),": Convert NCCL test output to CSV format"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/micro-benchmarks/nccl-tests/slurm/topology-aware-nccl-tests/process_nccl_results.sh",children:(0,t.jsx)(s.code,{children:"process_nccl_results.sh"})})}),": Comprehensive result processing script"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"usage-example",children:"Usage Example"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Run NCCL test and process results\nsbatch nccl-tests-container.sbatch\n\n# Convert output to CSV (after job completes)\npython3 nccl_to_csv.py slurm-<job-id>.out > nccl_results.csv\n\n# For topology-aware tests, use the automated processing\ncd topology-aware-nccl-tests\n./process_nccl_results.sh\n"})}),"\n",(0,t.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsx)(s.p,{children:"After successful NCCL testing:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Proceed to ",(0,t.jsx)(s.a,{href:"/docs/validation-and-testing/performance-testing/gpu-stress-testing",children:"GPU stress testing"})]}),"\n",(0,t.jsxs)(s.li,{children:["Run ",(0,t.jsx)(s.a,{href:"/docs/validation-and-testing/performance-testing/nccom-tests",children:"Trainium NCCOM tests"})," if using Trainium instances"]}),"\n",(0,t.jsxs)(s.li,{children:["Set up ",(0,t.jsx)(s.a,{href:"/docs/add-ons/Observability/",children:"continuous monitoring"})," for ongoing performancelidation"]}),"\n",(0,t.jsx)(s.li,{children:"Begin distributed training workloads with EKS or SLURM with confidence"}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);