"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4368],{4014:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Tips/EKS/add-users","title":"Add users to your EKS HyperPod cluster","description":"If you have multiple users trying to get access to your EKS cluster, you would need to set up IAM Access Entries for EKS. This section of the workshop details the steps you can use for this purpose.","source":"@site/docs/08-Tips/EKS/07-add-users.md","sourceDirName":"08-Tips/EKS","slug":"/Tips/EKS/add-users","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/EKS/add-users","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Add users to your EKS HyperPod cluster","weight":48},"sidebar":"tutorialSidebar","previous":{"title":"SSM Login","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/EKS/ssm-login"},"next":{"title":"Receive cluster status/health events","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/EKS/event-bridge"}}');var t=n(4848),i=n(8453);const o={title:"Add users to your EKS HyperPod cluster",weight:48},a=void 0,l={},c=[{value:"How to get IAM Access Entries for your EKS HyperPod cluster",id:"how-to-get-iam-access-entries-for-your-eks-hyperpod-cluster",level:2},{value:"1. Granting Direct Access to IAM users",id:"1-granting-direct-access-to-iam-users",level:2},{value:"Add multiple users in at once (programatically)",id:"add-multiple-users-in-at-once-programatically",level:4},{value:"Add users in one at a time (manually)",id:"add-users-in-one-at-a-time-manually",level:4},{value:"2. Granting Access to IAM roles",id:"2-granting-access-to-iam-roles",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:["If you have multiple users trying to get access to your EKS cluster, you would need to set up ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html",children:"IAM Access Entries for EKS"}),". This section of the workshop details the steps you can use for this purpose."]}),"\n",(0,t.jsxs)(s.admonition,{type:"note",children:[(0,t.jsx)(s.p,{children:"There are different IAM entities that you can give access to. This section of the workshop covers:"}),(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Granting Direct Access to ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html",children:"IAM users"})]}),"\n",(0,t.jsxs)(s.li,{children:["Granting Access to assumed ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html",children:"IAM roles"})]}),"\n"]}),(0,t.jsxs)(s.p,{children:["Process 2 is recommended as part of ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#bp-workloads-use-roles",children:"AWS Security Best practices"}),". The reason is simple: with IAM roles, you get temporary credentials, so you don\u2019t have to worry about things like stolen credentials, rotating credentials etc. Additionally, you can use roles to give AWS services access to each other. For example, you can have an EC2 instance assume a role to write to S3 buckets \u2014 so rather than having a user do that using their credentials, you can use your service credentials."]})]}),"\n",(0,t.jsx)(s.h2,{id:"how-to-get-iam-access-entries-for-your-eks-hyperpod-cluster",children:"How to get IAM Access Entries for your EKS HyperPod cluster"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Navigate to your ",(0,t.jsx)(s.a,{href:"https://us-east-2.console.aws.amazon.com/eks/home?region=us-east-2#/home",children:"EKS console"})]}),"\n",(0,t.jsx)(s.li,{children:"Select \u201cClusters\u201d and choose the hyperlink of your deployed cluster"}),"\n",(0,t.jsx)(s.li,{children:"Switch to the \u201cAccess\u201d tab"}),"\n",(0,t.jsx)(s.li,{children:"Under \u201cIAM access entries\u201d, you\u2019ll see all of your access entries"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"To get a list of all available access policies for your IAM users and roles, run the following from an admin user account"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"aws eks list-access-policies --output table\n"})}),"\n",(0,t.jsx)(s.p,{children:"An example output is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"---------------------------------------------------------------------------------------------------------\n|                                          ListAccessPolicies                                           |\n+-------------------------------------------------------------------------------------------------------+\n||                                           accessPolicies                                            ||\n|+---------------------------------------------------------------------+-------------------------------+|\n||                                 arn                                 |             name              ||\n|+---------------------------------------------------------------------+-------------------------------+|\n||  {arn-aws}eks::aws:cluster-access-policy/AmazonEKSAdminPolicy        |  AmazonEKSAdminPolicy         ||\n||  {arn-aws}eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy |  AmazonEKSClusterAdminPolicy  ||\n||  {arn-aws}eks::aws:cluster-access-policy/AmazonEKSEditPolicy         |  AmazonEKSEditPolicy          ||\n||  {arn-aws}eks::aws:cluster-access-policy/AmazonEKSViewPolicy         |  AmazonEKSViewPolicy          ||\n|+---------------------------------------------------------------------+-------------------------------+|\n"})}),"\n",(0,t.jsx)(s.h2,{id:"1-granting-direct-access-to-iam-users",children:"1. Granting Direct Access to IAM users"}),"\n",(0,t.jsx)(s.p,{children:"You can either do this programatically (for adding in multiple users at once), or manually (one user at a time)."}),"\n",(0,t.jsx)(s.h4,{id:"add-multiple-users-in-at-once-programatically",children:"Add multiple users in at once (programatically)"}),"\n",(0,t.jsx)(s.p,{children:"On a .txt file, list out all your users, separated by line. For example:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"user1\nuser2\nuser3\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Note: These have to be valid ",(0,t.jsx)(s.em,{children:"IAM users"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["Then, run the following on your terminal to write a bash script that will add in users for you. This bash script by default contains the ",(0,t.jsx)(s.code,{children:"AmazonEKSClusterAdminPolicy"}),". Feel free to change that to whatever permission you'd like to give your user(s)."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'cat << \'EOF\' > add_eks_users.sh\n#!/bin/bash\n\nif [ $# -ne 2 ]; then\n    echo "Usage: $0 <cluster-name> <users-file>"\n    echo "Example: $0 my-cluster users.txt"\n    exit 1\nfi\n\nCLUSTER_NAME=$1\nUSERS_FILE=$2\nACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)\n\n# Check if users file exists\nif [ ! -f "$USERS_FILE" ]; then\n    echo "Error: Users file $USERS_FILE not found"\n    exit 1\nfi\n\n# Process each user\nwhile read username; do\n    echo "Adding user: $username"\n    \n    # Create access entry\n    aws eks create-access-entry \\\n        --cluster-name "$EKS_CLUSTER_NAME" \\\n        --principal-arn "arn:aws:iam::${ACCOUNT_ID}:user/${username}" \\\n        --type "STANDARD"\n\n    # Associate admin policy\n    aws eks associate-access-policy \\\n        --cluster-name "$EKS_CLUSTER_NAME" \\\n        --principal-arn "arn:aws:iam::${ACCOUNT_ID}:user/${username}" \\\n        --policy-arn "arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy" \\\n        --access-scope \'{"type": "cluster"}\'\n\n    echo "Successfully added user $username to cluster $EKS_CLUSTER_NAME"\ndone < "$USERS_FILE"\n\necho "All users have been added to the cluster!"\nEOF\n\nchmod +x add_eks_users.sh\n'})}),"\n",(0,t.jsx)(s.p,{children:"You can then run this script!"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Example\n./add_eks_users.sh example_cluster users.txt\n"})}),"\n",(0,t.jsx)(s.h4,{id:"add-users-in-one-at-a-time-manually",children:"Add users in one at a time (manually)"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"On your IAM console, navigate to your users"}),"\n",(0,t.jsx)(s.li,{children:"Select the hyperlink of user you\u2019d like to give access to your EKS cluster"}),"\n",(0,t.jsxs)(s.li,{children:["On there, grab the ARN of that user. It should look something like ",(0,t.jsx)(s.code,{children:"arn:aws:iam::<account id>:user/<user name>"})]}),"\n",(0,t.jsx)(s.li,{children:"Switch over to your IAM Access Entries tab and hit \u201cCreate access entry\u201d"}),"\n",(0,t.jsx)(s.li,{children:"For IAM principal ARN, paste in the ARN of the IAM user you grabbed earlier"}),"\n",(0,t.jsx)(s.li,{children:"You can leave Type as Standard"}),"\n",(0,t.jsxs)(s.li,{children:["On the next page, under Policy name select the most relevant policy for the user. If you\u2019d like to give them admin access to your cluster, select ",(0,t.jsx)(s.code,{children:"AmazonEKSClusterAdminPolicy"}),"."]}),"\n",(0,t.jsx)(s.li,{children:"Select the scope of access for that user (i.e., entire cluster vs a namespace)"}),"\n",(0,t.jsx)(s.li,{children:"Review and Create!"}),"\n",(0,t.jsx)(s.li,{children:"You\u2019ll have to do this for every user that you want to add."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"2-granting-access-to-iam-roles",children:"2. Granting Access to IAM roles"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["On your ",(0,t.jsx)(s.a,{href:"https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-2#/policies",children:"IAM console"}),", navigate to your policies"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"[One time step]"})," Hit Create policy -- these workshop instructions describe adding full Admin permissions to EKS. Modify this accordingly.","\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:'Select \u201cVisual\u201d (default) for your policy editor, and choose "EKS" for "Service".'}),"\n",(0,t.jsx)(s.li,{children:'Once you select EKS, hit the check box for "All EKS actions (eks *)".  Under "Resources", select "All".'}),"\n",(0,t.jsxs)(s.li,{children:["On the next page, name your policy ",(0,t.jsx)(s.code,{children:"EKSFullAccessPolicy"})]}),"\n",(0,t.jsx)(s.li,{children:"Hit Create policy."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"[One time step]"})," Navigate to roles, and hit Create role","\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Select \u201cAWS account\u201d to allow your users to assume this role. Note: this means that only people using your account will be able to assume the role."}),"\n",(0,t.jsxs)(s.li,{children:["On the next page, select the newly created ",(0,t.jsx)(s.code,{children:"EKSFullAccessPolicy"})]}),"\n",(0,t.jsxs)(s.li,{children:["Name the role ",(0,t.jsx)(s.code,{children:"EKSFullAccessRole"})," and add in a description."]}),"\n",(0,t.jsxs)(s.li,{children:['Hit "Create role". Grab the ',(0,t.jsx)(s.code,{children:"ARN"})," of the role. It should looks something like ",(0,t.jsx)(s.code,{children:"arn:aws:iam::<account id>:role/<role name>"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["Now, your users can assume this role, and you\u2019ll only be managing a single EKS access entry! First things first, add this role in as an access entry.","\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Navigate to your Access Entries page and hit \u201cCreate access entry\u201d"}),"\n",(0,t.jsxs)(s.li,{children:["For IAM principal ARN, paste in the ARN of the ",(0,t.jsx)(s.em,{children:"IAM role"})," you grabbed earlier"]}),"\n",(0,t.jsx)(s.li,{children:'You can leave Type as "Standard".'}),"\n",(0,t.jsxs)(s.li,{children:["On the next page, under Policy name select the most relevant policy for the user. If you\u2019d like to give them admin access to your cluster, select ",(0,t.jsx)(s.code,{children:"AmazonEKSClusterAdminPolicy"}),"."]}),"\n",(0,t.jsx)(s.li,{children:"Select the scope of access for that user (i.e., entire cluster vs a namespace)"}),"\n",(0,t.jsx)(s.li,{children:"Review and Create!"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.admonition,{type:"note",children:[(0,t.jsx)(s.p,{children:"How can a user assume this role?"}),(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["As a configured user in the account where the EKS cluster is added, run ",(0,t.jsx)(s.code,{children:"aws sts assume-role \u2014role-arn <role arn you grabbed earlier> \u2014role-session-name <anything you want to name your session>"})]}),"\n",(0,t.jsxs)(s.li,{children:["This will return an ",(0,t.jsx)(s.code,{children:"AWS_ACCESS_KEY_ID"}),", ",(0,t.jsx)(s.code,{children:"AWS_SECRET_ACCESS_KEY"}),", and ",(0,t.jsx)(s.code,{children:"AWS_SESSION_TOKEN"}),". Copy these and set them as environment variables like ",(0,t.jsx)(s.code,{children:"export AWS_ACCESS_KEY_ID=ABCD1234"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Remember these are temporary credentials. This is a faster admin set up, but your user may need to restart their sessions by running the ",(0,t.jsx)(s.code,{children:"sts"})," command."]}),"\n"]})]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>a});var r=n(6540);const t={},i=r.createContext(t);function o(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);