"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5320],{1909:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ior_test6-8fef83f3c01abe77471955d6611f6b93.png"},6158:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ior_test5-fffbdf898748844b7321caadaea1ab7e.png"},8076:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"Tips/Common/Fsx for Lustre performance","title":"FSx for Lustre performance","description":"In this section you\'ll run IOPS and throughput performance tests agains the FSx for Lustre file system using IOR framework.","source":"@site/docs/08-Tips/Common/22-Fsx for Lustre performance.md","sourceDirName":"08-Tips/Common","slug":"/Tips/Common/Fsx for Lustre performance","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/Common/Fsx for Lustre performance","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":22,"frontMatter":{"title":"FSx for Lustre performance","weight":62},"sidebar":"tutorialSidebar","previous":{"title":"FSx for Lustre Best practices","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/Common/Fsx for Lustre best practices"},"next":{"title":"FSx for Lustre compression","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/Common/Fsx for Lustre compression"}}');var t=s(4848),r=s(8453);const o={title:"FSx for Lustre performance",weight:62},a=void 0,c={},l=[{value:"IOR",id:"ior",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",div:"div",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"In this section you'll run IOPS and throughput performance tests agains the FSx for Lustre file system using IOR framework."}),"\n",(0,t.jsx)(n.h2,{id:"ior",children:"IOR"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://ior.readthedocs.io/en/latest/",children:"IOR"})," is a parallel IO benchmark that can be used to test the performance of parallel storage systems using various interfaces and access patterns. The IOR repository also includes the mdtest benchmark which specifically tests the peak metadata rates of storage systems under different directory structures. Both benchmarks use a common parallel I/O abstraction backend and rely on MPI for synchronization. This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License (as published by the Free Software Foundation) version 2, dated June 1991."]}),"\n",(0,t.jsx)(n.admonition,{title:"Important",type:"warning",children:(0,t.jsx)(n.p,{children:"Complete these steps from the shell window connected to the head node."})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Install ior."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd\nwget https://github.com/hpc/ior/releases/download/4.0.0rc1/ior-4.0.0rc1.tar.gz\ntar xvzf ior-4.0.0rc1.tar.gz\ncd ior-4.0.0rc1\nsudo ldconfig\n./configure --with-lustre\nmake all\nsudo make install\ncd\n"})}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"Making install in contrib\nmake[2]: Nothing to be done for `install-exec-am'.\nmake[2]: Nothing to be done for `install-data-am'.\nmake[2]: Nothing to be done for `install-exec-am'.\nmake[2]: Nothing to be done for `install-data-am'.\n[ec2-user@ip-172-31-55-225 ior-4.0.0rc1]$ cd\n[ec2-user@ip-172-31-55-225 ~]$\n"})})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Use ior to generate 32 GiB of data with one file per thread using one thread."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"_job_name=ior\n_segment_count=32768\n_threads=1\n_path=/fsx/${_job_name}\nmkdir -p ${_path}\ntime mpirun --npernode ${_threads} ior --posix.odirect -t 1m -b 1m -s ${_segment_count} -g -v -w -i 1 -F -k -D 0 -o ${_path}/ior.bin\n"})}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"IOR-4.0.0rc1: MPI Coordinated Test of Parallel I/O\nBegan               : Mon Jan 22 12:02:00 2025\nCommand line        : ior --posix.odirect -t 1m -b 1m -s 32768 -g -v -w -i 1 -F -k -D 0 -o /fsx/ior/ior.bin\nMachine             : Linux ip-172-31-55-225\nTestID              : 0\nStartTime           : Mon Jan 22 12:02:00 2025\nPath                : /fsx/ior/ior.bin.00000000\nFS                  : 6.7 TiB   Used FS: 0.5%   Inodes: 27.1 Mi   Used Inodes: 1.5%\nParticipating tasks : 1\n\nOptions:\napi                 : POSIX\napiVersion          :\ntest filename       : /fsx/ior/ior.bin\naccess              : file-per-process\ntype                : independent\nsegments            : 32768\nordering in a file  : sequential\nordering inter file : no tasks offsets\nnodes               : 1\ntasks               : 1\nclients per node    : 1\nrepetitions         : 1\nxfersize            : 1 MiB\nblocksize           : 1 MiB\naggregate filesize  : 32 GiB\nverbose             : 1\n\nResults:\n\naccess    bw(MiB/s)  IOPS       Latency(s)  block(KiB) xfer(KiB)  open(s)    wr/rd(s)   close(s)   total(s)   iter\n------    ---------  ----       ----------  ---------- ---------  --------   --------   --------   --------   ----\nCommencing write performance test: Mon Jan 20 12:02:00 2025\n"})})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["Wait until the ior job completes.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"What was the Max Write: throughput?"}),"\n",(0,t.jsx)(n.li,{children:"How long did it take?"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Fsx IOR test1",src:s(8138).A+"",width:"1007",height:"386"})})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"Use ior to read the data using one thread."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"time mpirun --npernode ${_threads} ior -t 1m -b 1m -s ${_segment_count} -g -v -r -i 1 -F -k -D 0 -o ${_path}/ior.bin\n"})}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"IOR-4.0.0rc1: MPI Coordinated Test of Parallel I/O\nBegan               : Mon Jan 22 12:04:38 2025\nCommand line        : ior -t 1m -b 1m -s 32768 -g -v -r -i 1 -F -k -D 0 -o /fsx/ior/ior.bin\nMachine             : Linux ip-172-31-55-225\nTestID              : 0\nStartTime           : Mon Jan 22 12:04:38 2025\nPath                : /fsx/ior/ior.bin.00000000\nFS                  : 6.7 TiB   Used FS: 1.0%   Inodes: 27.0 Mi   Used Inodes: 1.5%\nParticipating tasks : 1\n\nOptions:\napi                 : POSIX\napiVersion          :\ntest filename       : /fsx/ior/ior.bin\naccess              : file-per-process\ntype                : independent\nsegments            : 32768\nordering in a file  : sequential\nordering inter file : no tasks offsets\nnodes               : 1\ntasks               : 1\nclients per node    : 1\nrepetitions         : 1\nxfersize            : 1 MiB\nblocksize           : 1 MiB\naggregate filesize  : 32 GiB\nverbose             : 1\n\nResults:\n\naccess    bw(MiB/s)  IOPS       Latency(s)  block(KiB) xfer(KiB)  open(s)    wr/rd(s)   close(s)   total(s)   iter\n------    ---------  ----       ----------  ---------- ---------  --------   --------   --------   --------   ----\nCommencing read performance test: Mon Jan 22 12:04:38 2025\n"})})}),"\n",(0,t.jsxs)(n.ol,{start:"5",children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Wait for the ior job to complete."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"What was the Max Read: throughput?"}),"\n",(0,t.jsx)(n.li,{children:"How long did it take?"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Fsx IOR test2",src:s(9249).A+"",width:"1006",height:"403"})})}),"\n",(0,t.jsxs)(n.ol,{start:"6",children:["\n",(0,t.jsx)(n.li,{children:"Use ior to generate 128 GiB of data with one file per thread using one thread per core. The head node is a c6gn.4xlarge Amazon EC2 instance with 16 vcpus (cores)."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"_job_name=ior\n_segment_count=8192\n_path=/fsx/${_job_name}\nmkdir -p ${_path}\ntime mpirun --map-by core ior --posix.odirect -t 1m -b 1m -s ${_segment_count} -g -v -w -i 1 -F -k -D 0 -o ${_path}/ior.bin\n"})}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'IOR-4.0.0rc1: MPI Coordinated Test of Parallel I/O\nBegan               : Mon Jan 20 12:09:10 2025\nCommand line        : ior --posix.odirect -t 1m -b 1m -s 8192 -g -v -w -i 1 -F -k -D 0 -o /fsx/ior/ior.bin\nMachine             : Linux ip-172-31-55-225\nTestID              : 0\nStartTime           : Mon Jan 20 12:09:10 2025\nPath                : /fsx/ior/ior.bin.00000000\nFS                  : 6.7 TiB   Used FS: 1.0%   Inodes: 27.0 Mi   Used Inodes: 1.5%\nParticipating tasks : 16\n\nOptions:\napi                 : POSIX\napiVersion          :\ntest filename       : /fsx/ior/ior.bin\naccess              : file-per-process\ntype                : independent\nsegments            : 8192\nordering in a file  : sequential\nordering inter file : no tasks offsets\nnodes               : 1\ntasks               : 16\nclients per node    : 16\nrepetitions         : 1\nxfersize            : 1 MiB\nblocksize           : 1 MiB\naggregate filesize  : 128 GiB\nverbose             : 1\n\nResults:\nWARNING: The file "/fsx/ior/ior.bin.00000001" exists already and will be overwritten\nWARNING: The file "/fsx/ior/ior.bin.00000000" exists already and will be overwritten\n\naccess    bw(MiB/s)  IOPS       Latency(s)  block(KiB) xfer(KiB)  open(s)    wr/rd(s)   close(s)   total(s)   iter\n------    ---------  ----       ----------  ---------- ---------  --------   --------   --------   --------   ----\nCommencing write performance test: Mon Jan 20 12:09:10 2025\n'})})}),"\n",(0,t.jsxs)(n.ol,{start:"7",children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Wait for the ior job to complete."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"What was the Max Read: throughput?"}),"\n",(0,t.jsx)(n.li,{children:"How long did it take?"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Fsx IOR test3",src:s(9032).A+"",width:"1007",height:"424"})})}),"\n",(0,t.jsxs)(n.ol,{start:"8",children:["\n",(0,t.jsx)(n.li,{children:"Use ior to read the data using one thread per core. The head node is a c6gn.4xlarge Amazon EC2 instance with 16 vcpus (cores)."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"time mpirun --map-by core ior -t 1m -b 1m -s ${_segment_count} -g -v -r -i 1 -F -k -D 0 -o ${_path}/ior.bin\n"})}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"IOR-4.0.0rc1: MPI Coordinated Test of Parallel I/O\nBegan               : Mon Jan 20 12:15:20 2025\nCommand line        : ior -t 1m -b 1m -s 8192 -g -v -r -i 1 -F -k -D 0 -o /fsx/ior/ior.bin\nMachine             : Linux ip-172-31-55-225\nTestID              : 0\nStartTime           : Mon Jan 20 12:15:20 2025\nPath                : /fsx/ior/ior.bin.00000000\nFS                  : 6.7 TiB   Used FS: 2.4%   Inodes: 26.6 Mi   Used Inodes: 1.5%\nParticipating tasks : 16\n\nOptions:\napi                 : POSIX\napiVersion          :\ntest filename       : /fsx/ior/ior.bin\naccess              : file-per-process\ntype                : independent\nsegments            : 8192\nordering in a file  : sequential\nordering inter file : no tasks offsets\nnodes               : 1\ntasks               : 16\nclients per node    : 16\nrepetitions         : 1\nxfersize            : 1 MiB\nblocksize           : 1 MiB\naggregate filesize  : 128 GiB\nverbose             : 1\n\nResults:\n\naccess    bw(MiB/s)  IOPS       Latency(s)  block(KiB) xfer(KiB)  open(s)    wr/rd(s)   close(s)   total(s)   iter\n------    ---------  ----       ----------  ---------- ---------  --------   --------   --------   --------   ----\nCommencing read performance test: Mon Jan 20 12:15:20 2025\n"})})}),"\n",(0,t.jsxs)(n.ol,{start:"9",children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Wait for the ior job to complete."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"What was the Max Read: throughput?"}),"\n",(0,t.jsx)(n.li,{children:"How long did it take?"}),"\n"]}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Fsx IOR test4",src:s(8647).A+"",width:"1006",height:"402"})})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Navigate back to the ",(0,t.jsx)(n.a,{href:"https://us-west-2.console.aws.amazon.com/fsx",children:"Amazon FSx"})," console. Monitor the Total throughput (bytes/sec) of the file system during the ior command. Amazon FSx publishes metrics to CloudWatch every minute, so you'll need to wait a few minutes for the graph to automatically refresh."]}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{alt:"Fsx IOR test5",src:s(6158).A+"",width:"1260",height:"343"}),"\n",(0,t.jsx)(n.img,{alt:"Fsx IOR test6",src:s(1909).A+"",width:"1253",height:"412"})]})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8138:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ior_test1-85aced599d753b53530533ddaf7f1257.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},8647:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ior_test4-3a635055c691ac6e51ca8b75fd01a6ec.png"},9032:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ior_test3-f087dbc68815ab8c427a4233b25db7c8.png"},9249:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ior_test2-e41f5689f5d0d71a4c558ee65a65dc7d.png"}}]);