"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7764],{7556:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Tips/EKS/ssm-login","title":"SSM Login","description":"Log into cluster instances using AWS Systems Manager","source":"@site/docs/08-Tips/EKS/01-ssm-login.md","sourceDirName":"08-Tips/EKS","slug":"/Tips/EKS/ssm-login","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/EKS/ssm-login","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"SSM Login","weight":41},"sidebar":"tutorialSidebar","previous":{"title":"Upload files to Amazon s3","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/Common/move-files-s3"},"next":{"title":"Add users to your EKS HyperPod cluster","permalink":"/ai-on-sagemaker-hyperpod/docs/Tips/EKS/add-users"}}');var r=n(4848),i=n(8453);const o={title:"SSM Login",weight:41},c=void 0,a={},l=[{value:"Log into cluster instances using AWS Systems Manager",id:"log-into-cluster-instances-using-aws-systems-manager",level:2},{value:"Log into cluster instances using SSH through SSM Proxy",id:"log-into-cluster-instances-using-ssh-through-ssm-proxy",level:2}];function d(e){const s={code:"code",h2:"h2",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"log-into-cluster-instances-using-aws-systems-manager",children:"Log into cluster instances using AWS Systems Manager"}),"\n",(0,r.jsx)(s.p,{children:"You can log into cluster nodes with AWS Systems Manager (SSM). This is useful for troubleshooting issues at the host environment level rather than the container level, such as investigating disk-full situations or getting low-level GPU error reports."}),"\n",(0,r.jsx)(s.p,{children:"To use SSM, you'll need to grab the cluster id, instance group name and the instance id:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Key"}),(0,r.jsx)(s.th,{children:"Example Value"}),(0,r.jsx)(s.th,{children:"Where to get"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Cluster id"}),(0,r.jsx)(s.td,{children:"q2vei6nzqldz"}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"arn"})," in ",(0,r.jsx)(s.code,{children:"describe-cluster"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Instance Group Name"}),(0,r.jsx)(s.td,{children:"group1"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"list-cluster-nodes"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Instance Id"}),(0,r.jsx)(s.td,{children:"i-08982ccd4b6b34eb1"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"list-cluster-nodes"})})]})]})]}),"\n",(0,r.jsx)(s.p,{children:"Then, construct a SSM target name in the following format:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"sagemaker-cluster:[cluster-id]_[instance-group-name]-[instance-id]\n"})}),"\n",(0,r.jsxs)(s.p,{children:["And run the ",(0,r.jsx)(s.code,{children:"aws ssm start-session"})," command on your terminal using the SSM target name:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"aws ssm start-session \\\n    --target sagemaker-cluster:aa11bbbbb222_group1-i-111222333444555aa \\\n    --region us-west-2\n"})}),"\n",(0,r.jsx)(s.p,{children:"Note that this initially connects you as the root user. You can switch to the ec2-user by running the following command."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"sh-4.2# sudo su - ec2-user\n[ec2-user@ip-11-22-33-44 ~]$\n"})}),"\n",(0,r.jsx)(s.h2,{id:"log-into-cluster-instances-using-ssh-through-ssm-proxy",children:"Log into cluster instances using SSH through SSM Proxy"}),"\n",(0,r.jsx)(s.p,{children:"You can also use SSH to log into cluster nodes using SSM as a proxy. This is useful if you want to use your favorite SSH client, or modern text editor's (e.g., VS Code) remote development capability."}),"\n",(0,r.jsxs)(s.p,{children:["First, start an SSM session, and add your SSH public key to ",(0,r.jsx)(s.code,{children:"~/.ssh/authorized_keys"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"sh-4.2# sudo su - ec2-user\n[ec2-user@ip-11-22-33-44 ~]$ echo {your_ssh_public_key} >> ~/.ssh/authorized_keys\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Then, add the following SSH host entry in your local development machine's SSH configuration file (",(0,r.jsx)(s.code,{children:"~/.ssh/config"}),"):"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Host my-cluster-group1-0\n    HostName sagemaker-cluster:aa11bbbbb222_group1-i-111222333444555aa\n    User ec2-user\n    IdentityFile ~/path/to/ssh-key.pem\n    ProxyCommand aws --profile default --region us-west-2 ssm start-session --target %h --document-name AWS-StartSSHSession --parameters portNumber=%p\n"})}),"\n",(0,r.jsx)(s.p,{children:"You can now start an SSH session using the host entry you added in the configuration file:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ssh my-cluster-group1-0\n"})})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>c});var t=n(6540);const r={},i=t.createContext(r);function o(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);