"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4380],{3852:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/amazon-cloudwatch-pods-5022ae5a8f3c5a8f6058895632c3b57d.png"},5580:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/cinsights-base-507d892cb2355fc127de4816da536357.png"},6123:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/cinsights-arch-3b01af50d3e70461cd65c42ca4603818.png"},6289:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/cinsights-efa-dc65a5c2a621eec268668ada1996c26a.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>r});var i=s(6540);const t={},a=i.createContext(t);function o(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(a.Provider,{value:n},e.children)}},8646:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"add-ons/Observability/Container Insights/Container Insights","title":"Amazon CloudWatch Container Insights (EKS only)","description":"CloudWatch Container Insights can be used to collect, aggregate, and summarize metrics and logs from your containerized applications and microservices.  Container Insights is available for Amazon Elastic Kubernetes Service (Amazon EKS) and helps collect metrics from cluster deployed on EKS.","source":"@site/docs/04-add-ons/Observability/Container Insights/Container Insights.md","sourceDirName":"04-add-ons/Observability/Container Insights","slug":"/add-ons/Observability/Container Insights/","permalink":"/ai-on-sagemaker-hyperpod/docs/add-ons/Observability/Container Insights/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Amazon CloudWatch Container Insights (EKS only)","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Observability with AMP and AMG (Slurm only)","permalink":"/ai-on-sagemaker-hyperpod/docs/add-ons/Observability/observability-slurm/"},"next":{"title":"SageMaker Managed MLflow","permalink":"/ai-on-sagemaker-hyperpod/docs/add-ons/Observability/MLFlow/"}}');var t=s(4848),a=s(8453);const o={title:"Amazon CloudWatch Container Insights (EKS only)",sidebar_position:4},r="Amazon CloudWatch Container Insights (EKS only)",l={},c=[{value:"Setup Environment Variables",id:"setup-environment-variables",level:3},{value:"Setup Container insights",id:"setup-container-insights",level:3},{value:"Container Insights Dashboards",id:"container-insights-dashboards",level:3},{value:"Using the console to check insights",id:"using-the-console-to-check-insights",level:3},{value:"Viewing cluster resources",id:"viewing-cluster-resources",level:4},{value:"GPU Utilization and GPU Memory",id:"gpu-utilization-and-gpu-memory",level:3},{value:"EFA metrics",id:"efa-metrics",level:3},{value:"Access CloudWatch container insights logs",id:"access-cloudwatch-container-insights-logs",level:3}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"amazon-cloudwatch-container-insights-eks-only",children:"Amazon CloudWatch Container Insights (EKS only)"})}),"\n",(0,t.jsx)(n.p,{children:"CloudWatch Container Insights can be used to collect, aggregate, and summarize metrics and logs from your containerized applications and microservices.  Container Insights is available for Amazon Elastic Kubernetes Service (Amazon EKS) and helps collect metrics from cluster deployed on EKS."}),"\n",(0,t.jsx)(n.p,{children:"The metrics that Container Insights collects are available in CloudWatch automatic dashboards. You can analyze and troubleshoot container performance and logs data with CloudWatch Logs Insights."}),"\n",(0,t.jsx)(n.p,{children:"In Amazon EKS and Kubernetes, Container Insights uses a containerized version of the CloudWatch agent to discover all of the running containers in a cluster. It then collects performance data at every layer of the performance stack."}),"\n",(0,t.jsx)(n.h3,{id:"setup-environment-variables",children:"Setup Environment Variables"}),"\n",(0,t.jsx)(n.p,{children:"First, ensure that you have sourced all the environment variables such as  EXECUTION_ROLE, EKS_CLUSTER_NAME"}),"\n",(0,t.jsx)(n.h3,{id:"setup-container-insights",children:"Setup Container insights"}),"\n",(0,t.jsx)(n.p,{children:"Below are the steps required to setup Container insights"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Verify the HyperPod execution role has CloudWatchAgentServerPolicy attached. If not, use the following command to attach the policy:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"export EX_ROLE_NAME=$(echo $EXECUTION_ROLE | sed 's/.*\\///') \naws iam attach-role-policy \\\n--role-name $EX_ROLE_NAME \\\n--policy-arn arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy\n\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Install the Amazon CloudWatch Observability EKS add-on."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aws eks create-addon --addon-name amazon-cloudwatch-observability --cluster-name $EKS_CLUSTER_NAME\n"})}),"\n",(0,t.jsx)(n.p,{children:"After the installation, the Amazon CloudWatch Observability will show in EKS cluster console under the Add-ons tab with status Active as shown below"}),"\n",(0,t.jsx)("div",{className:"text--center",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"import grafana dashboard",src:s(8790).A+"",width:"3180",height:"372"})})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Check if cloudwatch-agent and fluent-bit pods are running on EKS cluster under namespace amazon-cloudwatch using kubectl as shown below."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n amazon-cloudwatch\n"})}),"\n",(0,t.jsx)(n.p,{children:"Your output should be similar to the one below."}),"\n",(0,t.jsx)("div",{className:"text--center",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"import grafana dashboard",src:s(3852).A+"",width:"2308",height:"570"})})}),"\n",(0,t.jsx)(n.p,{children:"That\u2019s it! CloudWatch Container Insights will now be enabled for your EKS cluster. You can access the dashboard in CloudWatch console under Container Insights."}),"\n",(0,t.jsx)(n.h3,{id:"container-insights-dashboards",children:"Container Insights Dashboards"}),"\n",(0,t.jsx)(n.p,{children:"Once enabled, enhanced container insights page looks like below from AWS console, with the high level summary of your clusters, kube-state and control-plane metrics. The Container Insights dashboard shows cluster status and alarms. It uses predefined thresholds for CPU and memory to quickly identify which resources are having higher consumption, and enabling proactive actions to avoid performance impact."}),"\n",(0,t.jsx)(n.p,{children:"Below is the architecture diagram that shows the components that are involved in collecting logs and metrics from your EKS environment."}),"\n",(0,t.jsx)("div",{className:"text--center",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Container insights architecture",src:s(6123).A+"",width:"381",height:"411"})})}),"\n",(0,t.jsx)(n.h3,{id:"using-the-console-to-check-insights",children:"Using the console to check insights"}),"\n",(0,t.jsx)(n.h4,{id:"viewing-cluster-resources",children:"Viewing cluster resources"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"In the AWS Management Console on the Services menu, click CloudWatch."}),"\n",(0,t.jsx)(n.li,{children:"In the left navigation menu under Container Insights, Select Service: EKS."}),"\n",(0,t.jsxs)(n.li,{children:["Scroll down to the Clusters Overview section and select ",(0,t.jsx)(n.code,{children:"<Hyperpod cluster>"})," from the list of clusters."]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"This will return the performance monitoring for the selected cluster"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You should be able to see something like below"}),"\n",(0,t.jsx)("div",{className:"text--center",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Container insights dashboard",src:s(5580).A+"",width:"4970",height:"2040"})})}),"\n",(0,t.jsx)(n.p,{children:"This monitoring dashboard provides various views to analyze performance, including:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Cluster-wide performance dashboard view \u2013 Provides an overview of resource utilization across the entire cluster."}),"\n",(0,t.jsx)(n.li,{children:"Node performance view \u2013 Visualizes metrics at the individual node level."}),"\n",(0,t.jsx)(n.li,{children:"Pod performance view \u2013 Focuses on pod-level metrics for CPU, memory, network, etc."}),"\n",(0,t.jsx)(n.li,{children:"Container performance view \u2013 Drills down into utilization metrics for individual containers."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here you will be able to see the automatic performance dashboards created by CloudWatch Container Insights enhanced metrics for EKS. The Amazon CloudWatch Container Insights dashboards allow you to drill down into more detailed views to gain additional insights. we could start with the cluster-wide performance dashboard to get a high-level perspective. The different views allow methodically narrowing down to find the root cause, from cluster to node to pod to container."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Clusters"}),"\n",(0,t.jsx)(n.li,{children:"Namespaces"}),"\n",(0,t.jsx)(n.li,{children:"Nodes"}),"\n",(0,t.jsx)(n.li,{children:"Services"}),"\n",(0,t.jsx)(n.li,{children:"Workloads"}),"\n",(0,t.jsx)(n.li,{children:"Pods"}),"\n",(0,t.jsx)(n.li,{children:"Containers"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Click on a few of the options listed above to view the different dashboards."}),"\n",(0,t.jsx)(n.p,{children:"Also you can look at different graphs / metrics like GPU, EFA , CPU, Network utilizations. Below are some of the graphs that will be useful when training ML Models."}),"\n",(0,t.jsx)(n.h3,{id:"gpu-utilization-and-gpu-memory",children:"GPU Utilization and GPU Memory"}),"\n",(0,t.jsx)(n.p,{children:"We can look at both pod level and node level GPU metrics. Once you scroll on the dashboard you should be able to see something like below."}),"\n",(0,t.jsx)("div",{className:"text--center",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Container insights GPU metrics",src:s(9457).A+"",width:"4190",height:"1928"})})}),"\n",(0,t.jsx)(n.h3,{id:"efa-metrics",children:"EFA metrics"}),"\n",(0,t.jsx)(n.p,{children:"Similarly we can look EFA metrics including the network and RDMA bytes recieved."}),"\n",(0,t.jsx)("div",{className:"text--center",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Container insights EFA metrics",src:s(6289).A+"",width:"4188",height:"1304"})})}),"\n",(0,t.jsx)(n.h3,{id:"access-cloudwatch-container-insights-logs",children:"Access CloudWatch container insights logs"}),"\n",(0,t.jsx)(n.p,{children:"Go to the CloudWatch console, and log groups."}),"\n",(0,t.jsx)(n.p,{children:"The log group named in the following format should appear. You can check performance, host, application and data plane logs."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"/aws/containerinsights/<eks-cluster-name>/*\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8790:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/addon-eks-6a3bd316747777375f99efedc2cd2320.png"},9457:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/cinsights-gpu-152678be9cd1d990bac4002cb5716b41.png"}}]);