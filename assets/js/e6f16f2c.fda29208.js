"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9876],{49:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"slurm-blueprints/training/trainium/Llama3-70B/prep","title":"Setting up the software stack","description":"Tranium","source":"@site/docs/02-slurm-blueprints/training/trainium/Llama3-70B/01-prep.md","sourceDirName":"02-slurm-blueprints/training/trainium/Llama3-70B","slug":"/slurm-blueprints/training/trainium/Llama3-70B/prep","permalink":"/ai-on-sagemaker-hyperpod/docs/slurm-blueprints/training/trainium/Llama3-70B/prep","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Setting up the software stack","sidebar_position":2,"weight":31},"sidebar":"tutorialSidebar","previous":{"title":"Llama-3 70B (trn1.32xlarge) using NxD","permalink":"/ai-on-sagemaker-hyperpod/docs/slurm-blueprints/training/trainium/Llama3-70B/"},"next":{"title":"Downloading the Llama3-70b model","permalink":"/ai-on-sagemaker-hyperpod/docs/slurm-blueprints/training/trainium/Llama3-70B/download-model"}}');var r=t(4848),a=t(8453);const s={title:"Setting up the software stack",sidebar_position:2,weight:31},o=void 0,l={},u=[{value:"Python Virtual Environment Preparation",id:"python-virtual-environment-preparation",level:2},{value:"Clone the NxD Repository and install additional dependencies",id:"clone-the-nxd-repository-and-install-additional-dependencies",level:2}];function d(n){const e={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"Tranium",src:t(999).A+"",width:"768",height:"386"})}),"\n",(0,r.jsx)(e.p,{children:"In this section, we will prepare the software stack and scripts needed for the training. Specifically, we will:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Create a Python Virtual Environment, which includes NeuronX Distributed"}),"\n",(0,r.jsx)(e.li,{children:"Fetch the scripts used for the Llama3-70B training."}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"python-virtual-environment-preparation",children:"Python Virtual Environment Preparation"}),"\n",(0,r.jsxs)(e.p,{children:["First, let's create the Python Virtual Environment. We can then install ",(0,r.jsx)(e.code,{children:"torch-neuronx"})," and ",(0,r.jsx)(e.code,{children:"neuronx-distributed"}),"."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# Install Python venv \nsudo apt-get install -y python3.8-venv g++ \n\n# Create Python venv\npython3.8 -m venv /fsx/ubuntu/aws_neuron_venv_pytorch \n\n# Activate Python venv \nsource /fsx/ubuntu/aws_neuron_venv_pytorch/bin/activate \npython -m pip install -U pip \n\n# Set pip repository pointing to the Neuron repository \npython -m pip config set global.extra-index-url https://pip.repos.neuron.amazonaws.com\n\n# Install wget, awscli, and huggingface-cli \npython -m pip install wget awscli huggingface_hub \n\n# Install Neuron Compiler and Framework\npython -m pip install --upgrade neuronx-cc==2.* torch-neuronx==2.1.* torchvision\n\n#Install the neuronx-distributed package \npython -m pip install neuronx_distributed --extra-index-url https://pip.repos.neuron.amazonaws.com\n"})}),"\n",(0,r.jsxs)(e.p,{children:["This test case is with Neuron SDK 2.21.0. For the latest release versions, check ",(0,r.jsx)(e.a,{href:"https://awsdocs-neuron.readthedocs-hosted.com/en/latest/release-notes/index.html",children:"What's New"}),". Neuron SDK 2.21.0 includes:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"(aws_neuron_venv_pytorch) ubuntu:~$ pip list | grep neuron\nlibneuronxla              2.1.714.0\nneuronx-cc                2.16.372.0+4a9b2326\nneuronx-distributed       0.10.1\ntorch-neuronx             2.1.2.2.4.0\n\n$ srun -N1 dpkg -l | grep neuron # This command runs on a compute instance (trn1.32xlarge)\nii  aws-neuronx-collectives                2.23.133.0-3e70920f2                  amd64        neuron_ccom built using CMake\nii  aws-neuronx-dkms                       2.19.64.0                             amd64        aws-neuronx driver in DKMS format.\nii  aws-neuronx-oci-hook                   2.6.36.0                              amd64        neuron_oci_hook built using CMake\nii  aws-neuronx-runtime-lib                2.23.110.0-9b5179492                  amd64        neuron_runtime built using CMake\nii  aws-neuronx-tools                      2.20.204.0                            amd64        Neuron profile and debug tools\n"})}),"\n",(0,r.jsx)(e.h2,{id:"clone-the-nxd-repository-and-install-additional-dependencies",children:"Clone the NxD Repository and install additional dependencies"}),"\n",(0,r.jsxs)(e.p,{children:["Now that the virtual environment is prepared and ready, let's fetch the ",(0,r.jsx)(e.a,{href:"https://github.com/aws-neuron/neuronx-distributed/tree/main/examples/training/llama",children:"llama3 test case"})," from ",(0,r.jsx)(e.code,{children:"neuronx-distributed"}),". Let's clone it to our home directory"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"git clone https://github.com/aws-neuron/neuronx-distributed.git \\\n          /fsx/ubuntu/neuronx-distributed\n\n# Copy over just the llama3 test case under the home directory\ncp -r /fsx/ubuntu/neuronx-distributed/examples/training/llama /fsx/ubuntu/llama\ncd /fsx/ubuntu/llama\n\n# Install additional dependencies\nsource /fsx/ubuntu/aws_neuron_venv_pytorch/bin/activate\npython -m pip install -r requirements.txt\n"})})]})}function c(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},999:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/images/trn1-71450bb2a8e0922f022c3299b207551f.png"},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>o});var i=t(6540);const r={},a=i.createContext(r);function s(n){const e=i.useContext(a);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),i.createElement(a.Provider,{value:e},n.children)}}}]);