"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8430],{1883:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/add-user-2-bb1e0ca6c527dbc2d5c86e6db8a3e6a5.png"},2708:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/identity-center-enable-468ffab96b81787e22cb08061bbbbe50.png"},3546:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/slurm-dashboard-e4d5281a5bf099b3973fc059373875ab.png"},3582:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/dcgm-dashboard-a0ad5168286d29492fd3bb404176de2e.png"},4785:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/retrieve-amp-endpoint-ae265456a2c4edea908c4bfbc2defacb.png"},5634:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/efa-node-dashboard-96e860c9d52647d62cfa7987a6c015be.png"},5721:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/prometheus-remote-write-url-2daadd84257b9fdcc0c54d7d7a839a6c.png"},6228:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/os-grafana-set-datasource2-728d3977aa6a15761029a9fee1ea9620.png"},6861:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/observability_architecture-1f511d1934afb3d2ebf7c89c41a31a17.png"},7357:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/os-grafana-set-datasource3-f99ddef45d706787497ecf9afac9ee66.png"},7365:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/sign-in-9c7e0fe4a9f5db1b03d95a559c6d1c54.png"},7399:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"add-ons/Observability/observability-slurm/observability-slurm","title":"Observability with AMP and AMG (Slurm only)","description":"Overview","source":"@site/docs/04-add-ons/Observability/observability-slurm/observability-slurm.md","sourceDirName":"04-add-ons/Observability/observability-slurm","slug":"/add-ons/Observability/observability-slurm/","permalink":"/ai-on-sagemaker-hyperpod/docs/add-ons/Observability/observability-slurm/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Observability with AMP and AMG (Slurm only)","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"One-Click Observability with AMP and AMG (EKS only)","permalink":"/ai-on-sagemaker-hyperpod/docs/add-ons/Observability/one-click-observability-eks/"},"next":{"title":"Amazon CloudWatch Container Insights (EKS only)","permalink":"/ai-on-sagemaker-hyperpod/docs/add-ons/Observability/Container Insights/"}}');var r=n(4848),t=n(8453);const o={title:"Observability with AMP and AMG (Slurm only)",sidebar_position:3},i=void 0,l={},d=[{value:"Overview",id:"overview",level:2},{value:"Two Deployment Options",id:"two-deployment-options",level:2},{value:"Method 1: Amazon Managed Grafana + Amazon Managed Prometheus",id:"method-1-amazon-managed-grafana--amazon-managed-prometheus",level:2},{value:"Setup",id:"setup",level:3},{value:"1. Enable IAM Identity Center",id:"1-enable-iam-identity-center",level:3},{value:"2. Add additional permissions",id:"2-add-additional-permissions",level:3},{value:"2-a. Managed policy",id:"2-a-managed-policy",level:4},{value:"2-b. Inline policy",id:"2-b-inline-policy",level:4},{value:"3. Create workspaces for Prometheus and Grafana",id:"3-create-workspaces-for-prometheus-and-grafana",level:3},{value:"4. Add users to the Grafana workspace",id:"4-add-users-to-the-grafana-workspace",level:3},{value:"5. Modify the lifecycle scripts",id:"5-modify-the-lifecycle-scripts",level:3},{value:"6. Install Observability in your cluster",id:"6-install-observability-in-your-cluster",level:3},{value:"6-1. Create a new cluster",id:"6-1-create-a-new-cluster",level:4},{value:"6-2. Ad-hoc installation",id:"6-2-ad-hoc-installation",level:4},{value:"7. Verification",id:"7-verification",level:3},{value:"Method 2: Open Source Grafana + Amazon Managed Prometheus",id:"method-2-open-source-grafana--amazon-managed-prometheus",level:2},{value:"Setup",id:"setup-1",level:3},{value:"1. Deploy the CloudFormation Stack",id:"1-deploy-the-cloudformation-stack",level:4},{value:"2. Access Open Source Grafana",id:"2-access-open-source-grafana",level:4},{value:"3. Set Prometheus Workspace as Data Source",id:"3-set-prometheus-workspace-as-data-source",level:4},{value:"4. Configure Lifecycle Scripts and Install Observability",id:"4-configure-lifecycle-scripts-and-install-observability",level:4},{value:"5. Build Grafana Dashboards",id:"5-build-grafana-dashboards",level:4},{value:"Slurm Exporter Dashboard:",id:"slurm-exporter-dashboard",level:5},{value:"Node Exporter Dashboard:",id:"node-exporter-dashboard",level:5},{value:"DCGM Exporter Dashboard:",id:"dcgm-exporter-dashboard",level:5},{value:"FSx for Lustre Dashboard:",id:"fsx-for-lustre-dashboard",level:5},{value:"Next steps",id:"next-steps",level:2}];function c(e){const a={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(a.p,{children:["SageMaker HyperPod can optionally be integrated with ",(0,r.jsx)(a.a,{href:"https://docs.aws.amazon.com/prometheus/latest/userguide/what-is-Amazon-Managed-Service-Prometheus.html",children:"Amazon Managed Prometheus"})," and ",(0,r.jsx)(a.a,{href:"https://docs.aws.amazon.com/grafana/latest/userguide/what-is-Amazon-Managed-Service-Grafana.html",children:"Amazon Managed Grafana"})," to export metrics about your cluster and cluster-nodes to a Grafana dashboard."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"hyperpod observability architecture",src:n(6861).A+"",width:"2122",height:"1178"})}),"\n",(0,r.jsx)(a.p,{children:"This solution uses CloudFormation to deploy workspaces for Amazon Managed Prometheus and Grafana, and Hyperpod Lifecycle Scripts to install metrics exporters and OpenTelemetry Collector (OTEL) to your cluster. Also, you can install the solution to existing clusters as well by running commands interactively on the head node (Ad-hoc installation)."}),"\n",(0,r.jsxs)(a.p,{children:["Not all metrics are enabled by default or displayed in your Grafana workspace. Some metrics are categorized as ",(0,r.jsx)(a.strong,{children:"Advanced metrics"}),". Check the ",(0,r.jsx)(a.a,{href:"https://docs.aws.amazon.com/sagemaker/latest/dg/hyperpod-observability-cluster-metrics.html",children:"SageMaker HyperPod cluster metrics"})," page for more details."]}),"\n",(0,r.jsx)(a.h2,{id:"two-deployment-options",children:"Two Deployment Options"}),"\n",(0,r.jsx)(a.p,{children:"There are two methods to deploy observability for SageMaker HyperPod:"}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:(0,r.jsx)(a.a,{href:"#method-1-amazon-managed-grafana--amazon-managed-prometheus",children:"Amazon Managed Grafana (AMG) + Amazon Managed Prometheus (AMP)"})})," - Fully managed solution with IAM Identity Center authentication"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:(0,r.jsx)(a.a,{href:"#method-2-open-source-grafana--amazon-managed-prometheus",children:"Open Source Grafana + Amazon Managed Prometheus"})})," - Self-managed Grafana you don't have Identity Center access"]}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:"Choose the method that best fits your organization's requirements and authentication setup."}),"\n",(0,r.jsx)(a.h2,{id:"method-1-amazon-managed-grafana--amazon-managed-prometheus",children:"Method 1: Amazon Managed Grafana + Amazon Managed Prometheus"}),"\n",(0,r.jsx)(a.p,{children:"This is the recommended approach for production environments with IAM Identity Center enabled."}),"\n",(0,r.jsx)(a.h3,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(a.h3,{id:"1-enable-iam-identity-center",children:"1. Enable IAM Identity Center"}),"\n",(0,r.jsxs)(a.p,{children:["As a prerequisite to deploying this stack, you will need to have IAM Identity Center enabled for your account or organization. Amazon Managed Grafana uses IAM Identity Center to authenticate users to your dashboards. You can do this through the ",(0,r.jsx)(a.a,{href:"https://console.aws.amazon.com/singlesignon",children:"IAM Identity Center AWS Console"}),"."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Enable-IAM-Identity-Center",src:n(2708).A+"",width:"1751",height:"875"})}),"\n",(0,r.jsx)(a.h3,{id:"2-add-additional-permissions",children:"2. Add additional permissions"}),"\n",(0,r.jsx)(a.p,{children:"Also, you need to add following additional permissions to the IAM role for HyperPod instance groups."}),"\n",(0,r.jsx)(a.h4,{id:"2-a-managed-policy",children:"2-a. Managed policy"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"AmazonPrometheusRemoteWriteAccess\n"})}),"\n",(0,r.jsx)(a.h4,{id:"2-b-inline-policy",children:"2-b. Inline policy"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "VisualEditor0",\n            "Effect": "Allow",\n            "Action": [\n                "ecr:BatchGetImage",\n                "ecr:GetAuthorizationToken",\n                "ecr:GetDownloadUrlForLayer"\n            ],\n            "Resource": "*"\n        }\n    ]\n}\n'})}),"\n",(0,r.jsx)(a.h3,{id:"3-create-workspaces-for-prometheus-and-grafana",children:"3. Create workspaces for Prometheus and Grafana"}),"\n",(0,r.jsx)(a.p,{children:"Deploy the CloudFormation stack for your Amazon Managed Prometheus workspace and Amazon Managed Grafana workspace. It will automatically install pre-configured dashboards in your Grafana workspace. You can leave all parameters at their defaults."}),"\n",(0,r.jsx)("div",{style:{textAlign:"center",margin:"30px 0"},children:(0,r.jsx)("a",{href:"https://console.aws.amazon.com/cloudformation/home?#/stacks/quickcreate?templateURL=https://hpslurm-observability-us-east-1.s3.us-east-1.amazonaws.com/cluster-observability.yaml&stackName=HyperpodSlurmObservability",target:"_blank",rel:"noopener noreferrer",style:{backgroundColor:"#0073bb",color:"white",padding:"0",borderRadius:"8px",textDecoration:"none",fontWeight:"bold",fontSize:"18px",display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",boxShadow:"0 4px 8px rgba(0, 115, 187, 0.3)",transition:"all 0.2s ease",minWidth:"280px",height:"56px",textAlign:"center"},children:(0,r.jsx)("span",{style:{padding:"0 32px"},children:"\ud83d\ude80 Deploy Slurm Observability CF"})})}),"\n",(0,r.jsx)(a.p,{children:"This template creates Amazon Managed Prometheus and Amazon Managed Grafana workspaces with pre-configured dashboards."}),"\n",(0,r.jsx)(a.admonition,{title:"Note",type:"caution",children:(0,r.jsx)(a.p,{children:"Make sure you deploy this stack in the region where your HyperPod cluster is located."})}),"\n",(0,r.jsxs)(a.admonition,{type:"note",children:[(0,r.jsx)(a.mdxAdmonitionTitle,{}),(0,r.jsxs)(a.p,{children:["If you do not have Identity Center access, then please use ",(0,r.jsx)(a.a,{href:"#method-2-open-source-grafana--amazon-managed-prometheus",children:"Method 2: Open Source Grafana + Amazon Managed Prometheus"})," below."]})]}),"\n",(0,r.jsx)(a.h3,{id:"4-add-users-to-the-grafana-workspace",children:"4. Add users to the Grafana workspace"}),"\n",(0,r.jsxs)(a.p,{children:["From the ",(0,r.jsx)(a.a,{href:"https://console.aws.amazon.com/grafana/home#/workspaces",children:"Management Console for Amazon Managed Grafana"}),", select the workspace you just created by the CloudFormation."]}),"\n",(0,r.jsxs)(a.p,{children:["Select the ",(0,r.jsx)(a.strong,{children:"Configure users and groups"})," button and add your user."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"add-user-1",src:n(9875).A+"",width:"1540",height:"430"})}),"\n",(0,r.jsxs)(a.p,{children:["From the ",(0,r.jsx)(a.strong,{children:"Action"})," menu, select ",(0,r.jsx)(a.strong,{children:"Assign user"})," and ",(0,r.jsx)(a.strong,{children:"Make admin"})," to configure users for who need access to the Grafana workspace."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"add-user-2",src:n(1883).A+"",width:"1350",height:"696"})}),"\n",(0,r.jsx)(a.h3,{id:"5-modify-the-lifecycle-scripts",children:"5. Modify the lifecycle scripts"}),"\n",(0,r.jsx)(a.p,{children:"To install the metric exporters and OTEL collector on your cluster, edit the lifecycle scripts for the cluster by following these steps:"}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["Locate the Prometheus remote write URL in the ",(0,r.jsx)(a.code,{children:"Outputs"})," tab of the CloudFormation stack you just deployed. You will use the URL to configure the lifecycle scripts."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"prometheus-remote-write-url",src:n(5721).A+"",width:"1418",height:"560"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"If you don't have a copy of the lifecycle scripts locally, download them to your development machine so you can edit."}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"aws s3 sync s3://{bucket-name}/ ./{local-working-directory}\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["Open the ",(0,r.jsx)(a.code,{children:"config.py"})," file with your text editor, and change the value ",(0,r.jsx)(a.code,{children:"Config.enable_observability"})," to ",(0,r.jsx)(a.code,{children:"True"}),"."]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-python",children:"class Config:\n        :\n    enable_observability = True\n        :\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["Change the parameters of ",(0,r.jsx)(a.code,{children:"ObservabilityConfig"}),". Use the Prometheus remote write URL you located at the first step."]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-python",children:'class ObservabilityConfig:\n\n    # Prometheus remote write URL\n    prometheus_remote_write_url = "https://aps-workspaces.us-west-2.amazonaws.com/workspaces/{your-workspace-id}/api/v1/remote_write"\n\n    # Set true if you want to collect advanced metrics\n    advanced_metrics = True\n'})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Upload the lifecycle script to S3"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"aws s3 sync ./{local-working-directory} s3://{bucket-name}/\n"})}),"\n",(0,r.jsx)(a.admonition,{type:"note",children:(0,r.jsx)(a.p,{children:"Updating the lifecycle script is essential to ensure that metric exporters and OTEL collector are automatically configured on new cluster nodes during node replacement, scaling operations, and software updates."})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"6-install-observability-in-your-cluster",children:"6. Install Observability in your cluster"}),"\n",(0,r.jsx)(a.p,{children:"There are two options for installing observabability on a your HyperPod cluster, depending on where you are creating a new cluster from now or installing the observability on an existing cluster."}),"\n",(0,r.jsx)(a.h4,{id:"6-1-create-a-new-cluster",children:"6-1. Create a new cluster"}),"\n",(0,r.jsx)(a.p,{children:"If you are creating a new HyperPod cluster, use the lifecycle scripts you updated in the steps above. The lifecycle scripts will install necessary components (metrics exporters and OTEL collector) in your cluster."}),"\n",(0,r.jsx)(a.h4,{id:"6-2-ad-hoc-installation",children:"6-2. Ad-hoc installation"}),"\n",(0,r.jsx)(a.p,{children:"You can also enable Observability for an existing cluster by following these steps."}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["Login to the ",(0,r.jsx)(a.strong,{children:"head node"})," by SSM or SSH."]}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Set environment variables based on the number of worker nodes you have."}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"# Number of worker nodes you have\nexport NUM_WORKERS=16\n\n# Prometheus remote write URL you configured in the lifecycle script config.\nexport PROMETHEUS_REMOTE_WRITE_URL=https://aps-workspaces.us-west-2.amazonaws.com/workspaces/{your-workspace-id}/api/v1/remote_write\n\n# Set `--advanced` if you configured `advanced_metrics` to True in the lifecycle script config.\nexport ARG_ADVANCED=--advanced\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Make sure the Linux user you are using has sudo priviledge on both head node and worker nodes."}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"sudo hostname\nsrun -N $NUM_WORKERS sudo hostname\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["Clone the ",(0,r.jsx)(a.code,{children:"https://github.com/aws-samples/awsome-distributed-training.git"})," repository under a shared file system."]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"mkdir ~/observability-setup\ncd ~/observability-setup\ngit clone https://github.com/aws-samples/awsome-distributed-training.git\ncd awsome-distributed-training/1.architectures/5.sagemaker-hyperpod/LifecycleScripts/base-config/observability\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Stop observability components if they are running already running"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"sudo python3 stop_observability.py --node-type controller\nsrun -N $NUM_WORKERS sudo python3 stop_observability.py --node-type compute\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Install and run observability components"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"sudo python3 install_observability.py --node-type controller --prometheus-remote-write-url $PROMETHEUS_REMOTE_WRITE_URL $ARG_ADVANCED\nsrun -N $NUM_WORKERS sudo python3 install_observability.py --node-type compute --prometheus-remote-write-url $PROMETHEUS_REMOTE_WRITE_URL $ARG_ADVANCED\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Verify status of containers and services"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"systemctl status slurm_exporter.service --no-pager -l\ndocker ps\nsrun -N $NUM_WORKERS docker ps\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.strong,{children:"Example output"})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-text",children:'\u25cf slurm_exporter.service - Prometheus SLURM Exporter\n    Loaded: loaded (/etc/systemd/system/slurm_exporter.service; enabled; vendor preset: enabled)\n    Active: active (running) since Thu 2025-09-11 04:27:30 UTC; 1 day 20h ago\nMain PID: 2408455 (slurm_exporter)\n    Tasks: 39 (limit: 152887)\n    Memory: 12.0M\n        CPU: 35min 28.668s\n    CGroup: /system.slice/slurm_exporter.service\n            \u2514\u25002408455 /usr/bin/slurm_exporter\n\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="Collector enabled" collector=users\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="Collector enabled" collector=info\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="Collector enabled" collector=gpus\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="Collector enabled" collector=cpus\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="Collector enabled" collector=nodes\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="Collector enabled" collector=queue\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="Starting Slurm Exporter server..."\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="Command timeout configured" timeout=5s\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.540Z level=INFO msg="" level=info msg="Listening on" address=[::]:9341\nSep 11 04:27:30 ip-10-1-206-211 slurm_exporter[2408455]: time=2025-09-11T04:27:30.541Z level=INFO msg="" level=info msg="TLS is disabled." http2=false address=[::>\n\nCONTAINER ID   IMAGE                                                                                 COMMAND                  CREATED        STATUS        PORTS     NAMES\nda773247a262   602401143452.dkr.ecr.us-west-2.amazonaws.com/hyperpod/otel_collector:v1754424030352   "/app/otelcollector \u2026"   6 hours ago    Up 6 hours              otel-collector\n8c18b89cc1a3   602401143452.dkr.ecr.us-west-2.amazonaws.com/hyperpod/node_exporter:v1.9.1            "/bin/node_exporter \u2026"   45 hours ago   Up 45 hours             node-exporter\n\nCONTAINER ID   IMAGE                                                                                  COMMAND                  CREATED        STATUS        PORTS     NAMES\neb4fa31d8b17   602401143452.dkr.ecr.us-west-2.amazonaws.com/hyperpod/otel_collector:v1754424030352    "/app/otelcollector \u2026"   45 hours ago   Up 45 hours             otel-collector\n3ac63a09ba1f   602401143452.dkr.ecr.us-west-2.amazonaws.com/hyperpod/efa_exporter:1.0.0               "./node_exporter --p\u2026"   45 hours ago   Up 45 hours             efa-exporter\n48396ed3e3ef   602401143452.dkr.ecr.us-west-2.amazonaws.com/hyperpod/dcgm_exporter:4.1.1-4.0.4-ubi9   "/usr/local/dcgm/dcg\u2026"   45 hours ago   Up 45 hours             dcgm-exporter\n216eff1c9d55   602401143452.dkr.ecr.us-west-2.amazonaws.com/hyperpod/node_exporter:v1.9.1             "/bin/node_exporter \u2026"   45 hours ago   Up 45 hours             node-exporter\n    :\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"7-verification",children:"7. Verification"}),"\n",(0,r.jsxs)(a.p,{children:["From the ",(0,r.jsx)(a.a,{href:"https://console.aws.amazon.com/grafana/home#/workspaces",children:"Management Console for Amazon Managed Grafana"}),", select the workspace URL to open the dashboards. When the Sign-in screen pops up, login as a user you assigned in the ",(0,r.jsx)(a.strong,{children:"Add users to the Grafana workspace"})," step above."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"sign-in",src:n(7365).A+"",width:"1314",height:"918"})}),"\n",(0,r.jsxs)(a.p,{children:["From the left navigation pane, select ",(0,r.jsx)(a.strong,{children:"Dashboards"}),", and choose one of pre-configured dashboards. Following is a sample screenshot of the ",(0,r.jsx)(a.strong,{children:"NVIDIA DCGM Exporter Dashboard"}),"."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"dcgm-dashboard",src:n(3582).A+"",width:"2990",height:"1426"})}),"\n",(0,r.jsx)(a.hr,{}),"\n",(0,r.jsx)(a.h2,{id:"method-2-open-source-grafana--amazon-managed-prometheus",children:"Method 2: Open Source Grafana + Amazon Managed Prometheus"}),"\n",(0,r.jsx)(a.p,{children:"This method is ideal for customers who don't have access to IAM Identity Center or prefer a self-managed Grafana solution. It deploys a t2.micro EC2 instance running Open Source Grafana container along with Amazon Managed Service for Prometheus workspace."}),"\n",(0,r.jsx)(a.admonition,{title:"Important",type:"caution",children:(0,r.jsx)(a.p,{children:"Open Source Grafana offers a self-managed and less secure alternative to Amazon Managed Grafana. This method OSS solution is not recommended for production deployments."})}),"\n",(0,r.jsx)(a.h3,{id:"setup-1",children:"Setup"}),"\n",(0,r.jsx)(a.h4,{id:"1-deploy-the-cloudformation-stack",children:"1. Deploy the CloudFormation Stack"}),"\n",(0,r.jsx)(a.p,{children:"Deploy the CloudFormation stack for Open Source Grafana and Amazon Managed Prometheus workspace. This will create an EC2 instance running Grafana and the necessary Prometheus workspace."}),"\n",(0,r.jsx)("div",{style:{textAlign:"center",margin:"30px 0"},children:(0,r.jsx)("a",{href:"https://console.aws.amazon.com/cloudformation/home?#/stacks/quickcreate?templateURL=https://awsome-distributed-training.s3.us-east-1.amazonaws.com/templates/cluster-observability-with-os-grafana.yaml&stackName=HyperpodSlurmOSObservability",target:"_blank",rel:"noopener noreferrer",style:{backgroundColor:"#28a745",color:"white",padding:"0",borderRadius:"8px",textDecoration:"none",fontWeight:"bold",fontSize:"18px",display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none",cursor:"pointer",boxShadow:"0 4px 8px rgba(40, 167, 69, 0.3)",transition:"all 0.2s ease",minWidth:"320px",height:"56px",textAlign:"center"},children:(0,r.jsx)("span",{style:{padding:"0 32px"},children:"\ud83d\ude80 Deploy OS Observability CF"})})}),"\n",(0,r.jsx)(a.p,{children:"This template creates an EC2 instance with Open Source Grafana and Amazon Managed Prometheus workspace."}),"\n",(0,r.jsx)(a.admonition,{title:"Note",type:"caution",children:(0,r.jsx)(a.p,{children:"Make sure you deploy this stack in the region where your HyperPod cluster is located."})}),"\n",(0,r.jsx)(a.h4,{id:"2-access-open-source-grafana",children:"2. Access Open Source Grafana"}),"\n",(0,r.jsxs)(a.p,{children:["Navigate to the ",(0,r.jsx)(a.a,{href:"https://console.aws.amazon.com/cloudformation/home",children:"AWS CloudFormation Console"})," and fetch the ",(0,r.jsx)(a.strong,{children:"GrafanaInstanceAddress"})," output from the ",(0,r.jsx)(a.code,{children:"OS-Observability"})," stack."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"CFN-Output",src:n(7529).A+"",width:"2708",height:"1334"})}),"\n",(0,r.jsx)(a.p,{children:"Open the Grafana link in your browser:"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Grafana",src:n(8736).A+"",width:"2632",height:"1440"})}),"\n",(0,r.jsxs)(a.p,{children:["The default Grafana login credentials are ",(0,r.jsx)(a.code,{children:"admin/admin"}),". Please change the password after the first login."]}),"\n",(0,r.jsx)(a.h4,{id:"3-set-prometheus-workspace-as-data-source",children:"3. Set Prometheus Workspace as Data Source"}),"\n",(0,r.jsx)(a.p,{children:"Next, you can connect the Prometheus workspace with the Grafana dashboard by setting workspace as a data source."}),"\n",(0,r.jsx)(a.p,{children:'Navigate to "Data Sources" in Grafana and select "Prometheus".'}),"\n",(0,r.jsx)(a.admonition,{title:"Don't forget!",type:"info",children:(0,r.jsxs)(a.p,{children:["Don't forget to remove the ",(0,r.jsx)(a.code,{children:"/api/v1/query"})," part of the URL. The correct URL looks like this one:\n",(0,r.jsx)(a.a,{href:"https://aps-workspaces.us-west-2.amazonaws.com/workspaces/ws-123456-1234-1234-1234/",children:"https://aps-workspaces.us-west-2.amazonaws.com/workspaces/ws-123456-1234-1234-1234/"})]})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{src:n(8687).A+"",width:"2850",height:"1204"})}),"\n",(0,r.jsx)(a.p,{children:'Set the "Prometheus server URL" with the value retrieved from the AWS console.'}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.img,{src:n(4785).A+"",width:"2538",height:"934"}),"\n",(0,r.jsx)(a.img,{src:n(6228).A+"",width:"2108",height:"860"})]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.strong,{children:"For authentication:"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:['Choose "',(0,r.jsx)(a.code,{children:"SigV4 auth"}),'"']}),"\n",(0,r.jsxs)(a.li,{children:['Set "Authentication Provider" as "',(0,r.jsx)(a.code,{children:"AWS SDK Default"}),'"']}),"\n",(0,r.jsx)(a.li,{children:'Set "Default Region" to the region where you deployed the CloudFormation stack.'}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{src:n(7357).A+"",width:"1376",height:"770"})}),"\n",(0,r.jsx)(a.p,{children:"Once the datasource configuration test has passed, you can advance to the next step."}),"\n",(0,r.jsx)(a.h4,{id:"4-configure-lifecycle-scripts-and-install-observability",children:"4. Configure Lifecycle Scripts and Install Observability"}),"\n",(0,r.jsx)(a.p,{children:"Follow the same steps as in Method 1 for:"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"#2-add-additional-permissions",children:"Adding additional permissions"})}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"#5-modify-the-lifecycle-scripts",children:"Modifying the lifecycle scripts"})}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"#6-install-observability-in-your-cluster",children:"Installing Observability in your cluster"})}),"\n"]}),"\n",(0,r.jsx)(a.h4,{id:"5-build-grafana-dashboards",children:"5. Build Grafana Dashboards"}),"\n",(0,r.jsx)(a.p,{children:"Finally, with authentication and data sources setup, within your Grafana workspace, select dashboards > new > import."}),"\n",(0,r.jsx)(a.p,{children:"To display metrics for the exporter services, you can start by configuring and customizing the following open source Grafana Dashboards by copying and pasting the below links:"}),"\n",(0,r.jsx)(a.h5,{id:"slurm-exporter-dashboard",children:"Slurm Exporter Dashboard:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"https://grafana.com/grafana/dashboards/4323-slurm-dashboard/\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"slurm dashboard",src:n(3546).A+"",width:"2980",height:"1138"})}),"\n",(0,r.jsx)(a.h5,{id:"node-exporter-dashboard",children:"Node Exporter Dashboard:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"https://grafana.com/grafana/dashboards/1860-node-exporter-full/\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"EFA Node dashboard",src:n(5634).A+"",width:"2950",height:"1538"})}),"\n",(0,r.jsx)(a.h5,{id:"dcgm-exporter-dashboard",children:"DCGM Exporter Dashboard:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"https://grafana.com/grafana/dashboards/12239-nvidia-dcgm-exporter-dashboard/\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"DCGM Dashboard",src:n(3582).A+"",width:"2990",height:"1426"})}),"\n",(0,r.jsx)(a.h5,{id:"fsx-for-lustre-dashboard",children:"FSx for Lustre Dashboard:"}),"\n",(0,r.jsx)(a.p,{children:"For the Amazon FSx for Lustre dashboard you need to create an additional data source for the Amazon CloudWatch."}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"https://grafana.com/grafana/dashboards/20906-fsx/\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"FSxL Dashboard",src:n(8496).A+"",width:"1348",height:"823"})}),"\n",(0,r.jsx)(a.p,{children:"Congratulations, you can now view real time metrics about your SageMaker HyperPod Cluster and compute nodes in Grafana!"}),"\n",(0,r.jsx)(a.hr,{}),"\n",(0,r.jsx)(a.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["As needed, you can modify the pre-configured dashboards to meet your requirements. See the external ",(0,r.jsx)(a.a,{href:"https://grafana.com/docs/grafana-cloud/visualizations/dashboards/",children:"Grafana document"})," for more details."]}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"For Amazon Managed Grafana users"}),": Amazon Managed Grafana includes access to an updated alerting system that centralizes alerting information in a single, searchable view (in the navigation pane, choose Alerts to create an alert). Alerting is useful when you want to receive timely notifications, such as when GPU utilization drops unexpectedly, when a disk usage of your shared file system exceeds 90%, when multiple instances become unavailable at the same time, and so on. You can create alert rules based on metrics or queries and set up multiple notification channels, such as emails and Slack messages. For instructions on setting up alerts with Slack messages, see the ",(0,r.jsx)(a.a,{href:"https://github.com/aws-samples/awsome-distributed-training/blob/main/4.validation_and_observability/4.prometheus-grafana/README-grafana-alerts.md",children:"Setting Up Slack Alerts for Amazon Managed Grafana"})," GitHub page."]}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["The number of alerts is limited to 100 per Grafana workspace. If you need a more scalable solution, check out the ",(0,r.jsx)(a.a,{href:"https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-Ruler.html",children:"alerting options in Amazon Managed Service for Prometheus"}),"."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},7529:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/cfn-output-72eb9a65bfc852a1b47bbe2c1bf96724.png"},8453:(e,a,n)=>{n.d(a,{R:()=>o,x:()=>i});var s=n(6540);const r={},t=s.createContext(r);function o(e){const a=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:a},e.children)}},8496:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/fsxl-dashboard-ba62c1f69c279d8c506d2ff515bfe0ca.png"},8687:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/os-grafana-set-datasource1-26336303a956831f1cc3094fae3fa39b.png"},8736:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/grafana_home-c1d85e4a42e2605440ae10d0d5206add.png"},9875:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/add-user-1-1485b57512efa7de784ea8eed43bb0f4.png"}}]);