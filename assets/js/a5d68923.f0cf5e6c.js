"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4103],{1995:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"infrastructure-as-a-code/amazon-cloudFormation/amazon-cloudformation","title":"CloudFormation Deployment","description":"This guide covers deploying SageMaker HyperPod infrastructure using CloudFormation templates. CloudFormation templates are available for both EKS and Slurm orchestration types, providing Infrastructure as Code (IaC) solutions.","source":"@site/docs/07-infrastructure-as-a-code/amazon-cloudFormation/amazon-cloudformation.md","sourceDirName":"07-infrastructure-as-a-code/amazon-cloudFormation","slug":"/infrastructure-as-a-code/amazon-cloudFormation/","permalink":"/docs/infrastructure-as-a-code/amazon-cloudFormation/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"CloudFormation Deployment","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Terraform Deployment","permalink":"/docs/infrastructure-as-a-code/terraform/"}}');var l=r(4848),t=r(8453);const i={title:"CloudFormation Deployment",sidebar_position:2},a="CloudFormation Deployment for SageMaker HyperPod",c={},o=[{value:"EKS Orchestration",id:"eks-orchestration",level:2},{value:"Architecture Overview",id:"architecture-overview",level:3},{value:"Quick Start - EKS",id:"quick-start---eks",level:3},{value:"Deploy EKS HyperPod Cluster",id:"deploy-eks-hyperpod-cluster",level:4},{value:"EKS Nested Stacks",id:"eks-nested-stacks",level:3},{value:"1. VPCStack - <code>vpc-template.yaml</code>",id:"1-vpcstack---vpc-templateyaml",level:4},{value:"2. PrivateSubnetStack - <code>private-subnet-template.yaml</code>",id:"2-privatesubnetstack---private-subnet-templateyaml",level:4},{value:"3. SecurityGroupStack - <code>security-group-template.yaml</code>",id:"3-securitygroupstack---security-group-templateyaml",level:4},{value:"4. EKSClusterStack - <code>eks-template.yaml</code>",id:"4-eksclusterstack---eks-templateyaml",level:4},{value:"5. S3BucketStack - <code>s3-bucket-template.yaml</code>",id:"5-s3bucketstack---s3-bucket-templateyaml",level:4},{value:"6. S3EndpointStack - <code>s3-endpoint-template.yaml</code>",id:"6-s3endpointstack---s3-endpoint-templateyaml",level:4},{value:"7. LifeCycleScriptStack - <code>lifecycle-script-template.yaml</code>",id:"7-lifecyclescriptstack---lifecycle-script-templateyaml",level:4},{value:"8. SageMakerIAMRoleStack - <code>sagemaker-iam-role-template.yaml</code>",id:"8-sagemakeriamrolestack---sagemaker-iam-role-templateyaml",level:4},{value:"9. HelmChartStack - <code>helm-chart-template.yaml</code>",id:"9-helmchartstack---helm-chart-templateyaml",level:4},{value:"10. HyperPodClusterStack - <code>hyperpod-cluster-template.yaml</code>",id:"10-hyperpodclusterstack---hyperpod-cluster-templateyaml",level:4},{value:"11. FsxStack - <code>fsx-template.yaml</code>",id:"11-fsxstack---fsx-templateyaml",level:4},{value:"12. PrivateSubnetTagsStack - <code>private-subnet-tagging-template.yaml</code>",id:"12-privatesubnettagsstack---private-subnet-tagging-templateyaml",level:4},{value:"13. InferenceOperatorMainStack - <code>inference-operator-main-stack-template.yaml</code>",id:"13-inferenceoperatormainstack---inference-operator-main-stack-templateyaml",level:4},{value:"14. ObservabilityCustomStack",id:"14-observabilitycustomstack",level:4},{value:"Manual CloudFormation Deployment",id:"manual-cloudformation-deployment",level:3},{value:"Using AWS-Hosted Templates (Recommended)",id:"using-aws-hosted-templates-recommended",level:4},{value:"Using Custom S3 Bucket",id:"using-custom-s3-bucket",level:4},{value:"Slurm Orchestration",id:"slurm-orchestration",level:2},{value:"Quick Start - Slurm",id:"quick-start---slurm",level:3},{value:"Deploy Slurm HyperPod Cluster",id:"deploy-slurm-hyperpod-cluster",level:4},{value:"Slurm CloudFormation Templates",id:"slurm-cloudformation-templates",level:3},{value:"Main Stack - <code>main-stack-slurm-based-template.yaml</code>",id:"main-stack---main-stack-slurm-based-templateyaml",level:4},{value:"1. VPCStack - <code>slurm-vpc-template.yaml</code>",id:"1-vpcstack---slurm-vpc-templateyaml",level:4},{value:"2. SecurityGroupStack - <code>slurm-security-group-template.yaml</code>",id:"2-securitygroupstack---slurm-security-group-templateyaml",level:4},{value:"3. S3BucketStack",id:"3-s3bucketstack",level:4},{value:"4. LifeCycleScriptStack - <code>slurm-lifecycle-script-template.yaml</code>",id:"4-lifecyclescriptstack---slurm-lifecycle-script-templateyaml",level:4},{value:"5. SageMakerIAMRoleStack - <code>slurm-iam-role-template.yaml</code>",id:"5-sagemakeriamrolestack---slurm-iam-role-templateyaml",level:4},{value:"6. FsxStack - <code>slurm-fsx-template.yaml</code>",id:"6-fsxstack---slurm-fsx-templateyaml",level:4},{value:"7. HyperPodClusterStack - <code>slurm-hyperpod-cluster-template.yaml</code>",id:"7-hyperpodclusterstack---slurm-hyperpod-cluster-templateyaml",level:4},{value:"8. SSMStack - <code>slurm-ssm-template.yaml</code>",id:"8-ssmstack---slurm-ssm-templateyaml",level:4},{value:"Manual Deployment Steps",id:"manual-deployment-steps",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Deployment Sequence",id:"deployment-sequence",level:3},{value:"Configuration Examples",id:"configuration-examples",level:3},{value:"Slurm Cluster Configuration",id:"slurm-cluster-configuration",level:4},{value:"VPC Configuration",id:"vpc-configuration",level:4},{value:"Lifecycle Scripts",id:"lifecycle-scripts",level:2},{value:"For Slurm",id:"for-slurm",level:3},{value:"For EKS",id:"for-eks",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Getting Help",id:"getting-help",level:3},{value:"Clean Up",id:"clean-up",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"cloudformation-deployment-for-sagemaker-hyperpod",children:"CloudFormation Deployment for SageMaker HyperPod"})}),"\n",(0,l.jsx)(s.p,{children:"This guide covers deploying SageMaker HyperPod infrastructure using CloudFormation templates. CloudFormation templates are available for both EKS and Slurm orchestration types, providing Infrastructure as Code (IaC) solutions."}),"\n",(0,l.jsxs)(s.p,{children:["When using the ",(0,l.jsx)(s.a,{href:"/docs/getting-started/orchestrated-by-eks/initial-cluster-setup",children:"recommended in-console cluster creation"})," to deploy your HyperPod cluster, it will be using CloudFormation in the backend to deploy the resources."]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsxs)(s.strong,{children:["These CloudFormation templates are hosted in ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/tree/main",children:(0,l.jsx)(s.code,{children:"sagemaker-hyperpod-cluster-setup"})})," GitHub Repository."]})}),"\n",(0,l.jsx)(s.h2,{id:"eks-orchestration",children:"EKS Orchestration"}),"\n",(0,l.jsx)(s.h3,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,l.jsx)(s.p,{children:"The EKS CloudFormation deployment uses nested stacks to create a comprehensive HyperPod environment. Each stack is responsible for different infrastructure components."}),"\n",(0,l.jsx)(s.h3,{id:"quick-start---eks",children:"Quick Start - EKS"}),"\n",(0,l.jsxs)(s.p,{children:["\ud83d\udea8 ",(0,l.jsx)(s.strong,{children:"Recommended"}),": Follow the official AWS documentation for ",(0,l.jsx)(s.a,{href:"https://docs.aws.amazon.com/sagemaker/latest/dg/smcluster-getting-started-eks-console-create-cluster-cfn.html",children:"EKS orchestration"})," for detailed instructions and latest best practices."]}),"\n",(0,l.jsx)(s.h4,{id:"deploy-eks-hyperpod-cluster",children:"Deploy EKS HyperPod Cluster"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'# Deploy complete EKS-based HyperPod infrastructure\naws cloudformation create-stack \\\n  --stack-name hyperpod-eks-main-stack \\\n  --template-url https://aws-sagemaker-hyperpod-cluster-setup-us-west-2-prod.s3.us-west-2.amazonaws.com/templates/main-stack-eks-based-template.yaml \\\n  --parameters ParameterKey=ResourceNamePrefix,ParameterValue=my-hyperpod \\\n               ParameterKey=AvailabilityZoneIds,ParameterValue="usw2-az1,usw2-az2" \\\n               ParameterKey=HyperPodClusterName,ParameterValue=ml-cluster \\\n  --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM\n'})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Important Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"AvailabilityZoneIds"}),": Must correspond to your target region and have capacity for your instance types"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"ResourceNamePrefix"}),": Use consistent naming across all resources"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"HyperPodClusterName"}),": Name for your HyperPod cluster"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"Stage"}),": Deployment stage (prod/dev) - affects which S3 bucket is used for templates"]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"eks-nested-stacks",children:"EKS Nested Stacks"}),"\n",(0,l.jsxs)(s.p,{children:["The main CloudFormation template from ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/tree/main/eks/cloudformation",children:(0,l.jsx)(s.code,{children:"sagemaker-hyperpod-cluster-setup"})})," repository includes these nested stacks:"]}),"\n",(0,l.jsxs)(s.h4,{id:"1-vpcstack---vpc-templateyaml",children:["1. VPCStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/vpc-template.yaml",children:(0,l.jsx)(s.code,{children:"vpc-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates highly available VPC architecture across multiple Availability Zones."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"VPC with Internet Gateway"}),"\n",(0,l.jsx)(s.li,{children:"Public and Private Subnets across multiple AZs"}),"\n",(0,l.jsx)(s.li,{children:"NAT Gateways for outbound connectivity"}),"\n",(0,l.jsx)(s.li,{children:"Route Tables and associations"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"VpcCIDR"}),": VPC CIDR range"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"AvailabilityZoneIds"}),": List of AZ IDs for multi-AZ deployment"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"ResourceNamePrefix"}),": Consistent naming prefix"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Required if Disabled:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"VpcId"})," - Used by multiple other stacks"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"NatGatewayIds"})," - Used by PrivateSubnetStack"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"2-privatesubnetstack---private-subnet-templateyaml",children:["2. PrivateSubnetStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/private-subnet-template.yaml",children:(0,l.jsx)(s.code,{children:"private-subnet-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates dedicated private subnets for SageMaker HyperPod cross-account ENIs."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Secondary CIDR Block for HyperPod"}),"\n",(0,l.jsx)(s.li,{children:"Private Subnets in specified AZs"}),"\n",(0,l.jsx)(s.li,{children:"Private Route Tables with NAT Gateway routing"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"AvailabilityZoneIds"}),": Target availability zones"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"NatGatewayIds"}),": NAT Gateways for outbound access"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Required if Disabled:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"PrivateSubnetIds"})," - Used by HyperPodClusterStack"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"PrivateRouteTableIds"})," - Used by S3EndpointStack"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"3-securitygroupstack---security-group-templateyaml",children:["3. SecurityGroupStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/security-group-template.yaml",children:(0,l.jsx)(s.code,{children:"security-group-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Configures security group with EFA and FSx communication rules optimized for HyperPod."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Security Group with HyperPod-optimized rules"}),"\n",(0,l.jsx)(s.li,{children:"Intra-Security Group communication rules"}),"\n",(0,l.jsx)(s.li,{children:"EFA communication rules (all ports within SG)"}),"\n",(0,l.jsx)(s.li,{children:"FSx for Lustre Rules (TCP ports 988, 1018-1023)"}),"\n",(0,l.jsx)(s.li,{children:"Outbound internet access"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"VpcId"}),": Target VPC for security group"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"SecurityGroupIds"}),": Additional security groups to reference"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Required if Disabled:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"SecurityGroupId"})," - Used by EKSClusterStack and HyperPodClusterStack"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"4-eksclusterstack---eks-templateyaml",children:["4. EKSClusterStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/eks-template.yaml",children:(0,l.jsx)(s.code,{children:"eks-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates EKS cluster optimized for HyperPod workloads."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"EKS Private Subnets (separate from HyperPod subnets)"}),"\n",(0,l.jsx)(s.li,{children:"IAM Cluster Service Role"}),"\n",(0,l.jsx)(s.li,{children:"EKS Cluster with latest Kubernetes version"}),"\n",(0,l.jsxs)(s.li,{children:["Essential EKS Add-ons:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"VPC CNI (latest version)"}),"\n",(0,l.jsx)(s.li,{children:"kube-proxy"}),"\n",(0,l.jsx)(s.li,{children:"CoreDNS"}),"\n",(0,l.jsx)(s.li,{children:"EKS Pod Identity Agent"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.li,{children:"EKS Access Entries for cluster management"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"KubernetesVersion"}),": EKS cluster version"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"EKSClusterName"}),": Name for the EKS cluster"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"SecurityGroupIds"}),": Security groups for cluster"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Required if Disabled:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"EKSClusterName"})," - Used by HelmChartStack and HyperPodClusterStack"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"5-s3bucketstack---s3-bucket-templateyaml",children:["5. S3BucketStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/s3-bucket-template.yaml",children:(0,l.jsx)(s.code,{children:"s3-bucket-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates encrypted S3 bucket for lifecycle scripts and cluster artifacts."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"S3 Bucket with server-side encryption"}),"\n",(0,l.jsx)(s.li,{children:"Bucket policy for HyperPod access"}),"\n",(0,l.jsx)(s.li,{children:"Versioning and lifecycle policies"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"ResourceNamePrefix"}),": Bucket naming prefix"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"S3BucketName"}),": Custom bucket name (optional)"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Required if Disabled:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"S3BucketName"})," - Used by LifeCycleScriptStack and HyperPodClusterStack"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"6-s3endpointstack---s3-endpoint-templateyaml",children:["6. S3EndpointStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/s3-endpoint-template.yaml",children:(0,l.jsx)(s.code,{children:"s3-endpoint-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates VPC endpoint for private S3 connectivity from HyperPod instances."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"VPC Endpoint for S3 service"}),"\n",(0,l.jsx)(s.li,{children:"Route table associations for private subnets"}),"\n",(0,l.jsx)(s.li,{children:"Endpoint policy for secure access"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"VpcId"}),": Target VPC"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"PrivateRouteTableIds"}),": Route tables to associate"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"7-lifecyclescriptstack---lifecycle-script-templateyaml",children:["7. LifeCycleScriptStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/lifecycle-script-template.yaml",children:(0,l.jsx)(s.code,{children:"lifecycle-script-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Deploys Lambda function to create and manage default lifecycle scripts."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"AWS Lambda Function for script management"}),"\n",(0,l.jsx)(s.li,{children:"IAM Role for Lambda execution"}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/tree/main/1.architectures/7.sagemaker-hyperpod-eks/LifecycleScripts/base-config",children:"Default EKS Lifecycle Scripts"})," uploaded to S3"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"S3BucketName"}),": Target bucket for lifecycle scripts"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"GithubRawUrl"}),": Source URL for lifecycle scripts"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"OnCreatePath"}),": Path to on_create.sh script"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"8-sagemakeriamrolestack---sagemaker-iam-role-templateyaml",children:["8. SageMakerIAMRoleStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/sagemaker-iam-role-template.yaml",children:(0,l.jsx)(s.code,{children:"sagemaker-iam-role-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates IAM role with comprehensive permissions for HyperPod cluster operations."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"SageMaker Execution Role"}),"\n",(0,l.jsx)(s.li,{children:"Policies for HyperPod, EKS, and AWS service access"}),"\n",(0,l.jsx)(s.li,{children:"Trust relationships for SageMaker service"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"ResourceNamePrefix"}),": Role naming prefix"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"SageMakerIAMRoleName"}),": Custom role name (optional)"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Required if Disabled:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"SageMakerIAMRoleName"})," - Used by HyperPodClusterStack"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"9-helmchartstack---helm-chart-templateyaml",children:["9. HelmChartStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/helm-chart-template.yaml",children:(0,l.jsx)(s.code,{children:"helm-chart-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Automates installation of HyperPod dependency Helm charts on EKS cluster."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"AWS Lambda Function for Helm chart deployment"}),"\n",(0,l.jsx)(s.li,{children:"EKS Access Entry for Lambda function"}),"\n",(0,l.jsxs)(s.li,{children:["Kubernetes resources from ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cli/tree/main/helm_chart",children:"HyperPod Helm charts"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Health monitoring agents"}),"\n",(0,l.jsx)(s.li,{children:"Training operators"}),"\n",(0,l.jsx)(s.li,{children:"Inference operators (optional)"}),"\n",(0,l.jsx)(s.li,{children:"Observability components"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"EKSClusterName"}),": Target EKS cluster"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"HelmRepoUrl"}),": Helm repository URL"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"HelmOperators"}),": List of operators to install"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"Namespace"}),": Kubernetes namespace for deployment"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"10-hyperpodclusterstack---hyperpod-cluster-templateyaml",children:["10. HyperPodClusterStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/hyperpod-cluster-template.yaml",children:(0,l.jsx)(s.code,{children:"hyperpod-cluster-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates the SageMaker HyperPod cluster with flexible instance group configuration."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"SageMaker HyperPod Cluster"}),"\n",(0,l.jsx)(s.li,{children:"Multiple configurable instance groups (up to 20)"}),"\n",(0,l.jsx)(s.li,{children:"Auto-scaling configuration"}),"\n",(0,l.jsx)(s.li,{children:"Node recovery settings"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"HyperPodClusterName"}),": Cluster name"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"NodeRecovery"}),": Automatic or Manual"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"NodeProvisioningMode"}),": Continuous or OnDemand"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"AutoScalerType"}),": HyperPod native or Karpenter"]}),"\n",(0,l.jsxs)(s.li,{children:["Instance Group Settings (1-20): Each with:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Instance type and count"}),"\n",(0,l.jsx)(s.li,{children:"EBS volume configuration"}),"\n",(0,l.jsx)(s.li,{children:"Lifecycle script settings"}),"\n",(0,l.jsx)(s.li,{children:"Custom AMI options"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"11-fsxstack---fsx-templateyaml",children:["11. FsxStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/fsx-template.yaml",children:(0,l.jsx)(s.code,{children:"fsx-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates high-performance FSx for Lustre file system for shared storage."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"FSx for Lustre file system"}),"\n",(0,l.jsx)(s.li,{children:"Mount targets in private subnets"}),"\n",(0,l.jsx)(s.li,{children:"Security group rules for FSx access"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"StorageCapacity"}),": File system size in GiB"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"PerUnitStorageThroughput"}),": Performance tier"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"DeploymentType"}),": SCRATCH_1, SCRATCH_2, or PERSISTENT"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"DataCompressionType"}),": LZ4 compression option"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"12-privatesubnettagsstack---private-subnet-tagging-templateyaml",children:["12. PrivateSubnetTagsStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/private-subnet-tagging-template.yaml",children:(0,l.jsx)(s.code,{children:"private-subnet-tagging-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Applies necessary tags to private subnets for HyperPod and EKS integration."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Lambda function for subnet tagging"}),"\n",(0,l.jsx)(s.li,{children:"Tags for EKS cluster discovery"}),"\n",(0,l.jsx)(s.li,{children:"Tags for HyperPod subnet identification"}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"13-inferenceoperatormainstack---inference-operator-main-stack-templateyaml",children:["13. InferenceOperatorMainStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/eks/cloudformation/inference-operator-main-stack-template.yaml",children:(0,l.jsx)(s.code,{children:"inference-operator-main-stack-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Deploys inference operator components for HyperPod inference workloads (optional)."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Inference operator Helm charts"}),"\n",(0,l.jsx)(s.li,{children:"TLS certificates for secure communication"}),"\n",(0,l.jsx)(s.li,{children:"Service accounts and RBAC configurations"}),"\n",(0,l.jsx)(s.li,{children:"IAM roles for inference operations"}),"\n"]}),"\n",(0,l.jsx)(s.h4,{id:"14-observabilitycustomstack",children:"14. ObservabilityCustomStack"}),"\n",(0,l.jsx)(s.p,{children:"Deploys comprehensive observability stack with Prometheus and Grafana integration (optional)."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Amazon Managed Prometheus workspace"}),"\n",(0,l.jsx)(s.li,{children:"Amazon Managed Grafana workspace"}),"\n",(0,l.jsx)(s.li,{children:"CloudWatch integration"}),"\n",(0,l.jsx)(s.li,{children:"Custom dashboards for HyperPod metrics"}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"manual-cloudformation-deployment",children:"Manual CloudFormation Deployment"}),"\n",(0,l.jsxs)(s.p,{children:["The CloudFormation templates are automatically synced from AWS-managed S3 buckets to the ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup",children:(0,l.jsx)(s.code,{children:"sagemaker-hyperpod-cluster-setup"})})," repository. For custom deployments:"]}),"\n",(0,l.jsx)(s.h4,{id:"using-aws-hosted-templates-recommended",children:"Using AWS-Hosted Templates (Recommended)"}),"\n",(0,l.jsx)(s.p,{children:"The templates reference AWS-managed S3 buckets by default:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Production"}),": ",(0,l.jsx)(s.code,{children:"aws-sagemaker-hyperpod-cluster-setup-{region}-prod"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Development"}),": ",(0,l.jsx)(s.code,{children:"aws-sagemaker-hyperpod-cluster-setup-{region}-dev"})]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"Deploy directly using the main stack template:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'# Deploy EKS-based HyperPod cluster\naws cloudformation create-stack \\\n  --stack-name hyperpod-eks-cluster \\\n  --template-url https://aws-sagemaker-hyperpod-cluster-setup-us-west-2-prod.s3.us-west-2.amazonaws.com/templates/main-stack-eks-based-template.yaml \\\n  --parameters ParameterKey=ResourceNamePrefix,ParameterValue=my-hyperpod \\\n               ParameterKey=AvailabilityZoneIds,ParameterValue="usw2-az1,usw2-az2" \\\n  --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM\n'})}),"\n",(0,l.jsx)(s.h4,{id:"using-custom-s3-bucket",children:"Using Custom S3 Bucket"}),"\n",(0,l.jsx)(s.p,{children:"To host templates in your own S3 bucket:"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Clone the Repository"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"git clone https://github.com/aws/sagemaker-hyperpod-cluster-setup.git\ncd sagemaker-hyperpod-cluster-setup\n"})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Upload Templates to Your Bucket"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"BUCKET_NAME=<your-bucket-name>\naws s3 cp eks/cloudformation/ s3://$BUCKET_NAME/templates/ --recursive\naws s3 cp eks/cloudformation/resources/ s3://$BUCKET_NAME/resources/ --recursive\n"})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Deploy with Custom Bucket"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"aws cloudformation create-stack \\\n  --stack-name hyperpod-eks-cluster \\\n  --template-body file://eks/cloudformation/main-stack-eks-based-template.yaml \\\n  --parameters ParameterKey=CustomBucketName,ParameterValue=$BUCKET_NAME \\\n               ParameterKey=ResourceNamePrefix,ParameterValue=my-hyperpod \\\n  --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"slurm-orchestration",children:"Slurm Orchestration"}),"\n",(0,l.jsx)(s.h3,{id:"quick-start---slurm",children:"Quick Start - Slurm"}),"\n",(0,l.jsxs)(s.p,{children:["\ud83d\udea8 ",(0,l.jsx)(s.strong,{children:"Recommended"}),": Follow the official AWS documentation for ",(0,l.jsx)(s.a,{href:"https://docs.aws.amazon.com/sagemaker/latest/dg/smcluster-getting-started-slurm-console-create-cluster-cfn.html",children:"Slurm orchestration"})," for detailed instructions and latest best practices."]}),"\n",(0,l.jsx)(s.h4,{id:"deploy-slurm-hyperpod-cluster",children:"Deploy Slurm HyperPod Cluster"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'# Deploy complete Slurm-based HyperPod infrastructure\naws cloudformation create-stack \\\n  --stack-name hyperpod-slurm-main-stack \\\n  --template-url https://aws-sagemaker-hyperpod-cluster-setup-us-west-2-prod.s3.us-west-2.amazonaws.com/templates-slurm/main-stack-slurm-based-template.yaml \\\n  --parameters ParameterKey=ResourceNamePrefix,ParameterValue=my-hyperpod \\\n               ParameterKey=AvailabilityZoneIds,ParameterValue="usw2-az1,usw2-az2" \\\n               ParameterKey=HyperPodClusterName,ParameterValue=ml-cluster \\\n  --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM\n'})}),"\n",(0,l.jsx)(s.h3,{id:"slurm-cloudformation-templates",children:"Slurm CloudFormation Templates"}),"\n",(0,l.jsxs)(s.p,{children:["The Slurm deployment uses the main stack template from ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/tree/main/slurm/cloudformation",children:(0,l.jsx)(s.code,{children:"sagemaker-hyperpod-cluster-setup"})})," repository:"]}),"\n",(0,l.jsxs)(s.h4,{id:"main-stack---main-stack-slurm-based-templateyaml",children:["Main Stack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/slurm/cloudformation/main-stack-slurm-based-template.yaml",children:(0,l.jsx)(s.code,{children:"main-stack-slurm-based-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"The main Slurm stack includes these nested components:"}),"\n",(0,l.jsxs)(s.h4,{id:"1-vpcstack---slurm-vpc-templateyaml",children:["1. VPCStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/slurm/cloudformation/slurm-vpc-template.yaml",children:(0,l.jsx)(s.code,{children:"slurm-vpc-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates VPC infrastructure optimized for Slurm HyperPod clusters."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"VPC with public and private subnets"}),"\n",(0,l.jsx)(s.li,{children:"Internet Gateway and NAT Gateway"}),"\n",(0,l.jsx)(s.li,{children:"Route tables and security groups"}),"\n",(0,l.jsx)(s.li,{children:"S3 and DynamoDB VPC endpoints"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"VpcCIDR"}),": VPC CIDR range"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"AvailabilityZoneIds"}),": Target availability zones"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"ResourceNamePrefix"}),": Consistent naming"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"2-securitygroupstack---slurm-security-group-templateyaml",children:["2. SecurityGroupStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/slurm/cloudformation/slurm-security-group-template.yaml",children:(0,l.jsx)(s.code,{children:"slurm-security-group-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Configures security groups for Slurm cluster communication."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Security group with Slurm-specific rules"}),"\n",(0,l.jsx)(s.li,{children:"EFA communication rules"}),"\n",(0,l.jsx)(s.li,{children:"FSx for Lustre access rules"}),"\n",(0,l.jsx)(s.li,{children:"SSH and cluster communication ports"}),"\n"]}),"\n",(0,l.jsx)(s.h4,{id:"3-s3bucketstack",children:"3. S3BucketStack"}),"\n",(0,l.jsx)(s.p,{children:"Creates S3 bucket for Slurm lifecycle scripts and cluster artifacts."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Encrypted S3 bucket"}),"\n",(0,l.jsx)(s.li,{children:"Bucket policies for HyperPod access"}),"\n",(0,l.jsx)(s.li,{children:"Lifecycle script storage"}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"4-lifecyclescriptstack---slurm-lifecycle-script-templateyaml",children:["4. LifeCycleScriptStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/slurm/cloudformation/slurm-lifecycle-script-template.yaml",children:(0,l.jsx)(s.code,{children:"slurm-lifecycle-script-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Manages Slurm-specific lifecycle scripts."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Lambda function for script deployment"}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training/tree/main/1.architectures/5.sagemaker-hyperpod/LifecycleScripts/base-config",children:"Slurm Lifecycle Scripts"})," uploaded to S3"]}),"\n",(0,l.jsx)(s.li,{children:"Slurm configuration files"}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"5-sagemakeriamrolestack---slurm-iam-role-templateyaml",children:["5. SageMakerIAMRoleStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/slurm/cloudformation/slurm-iam-role-template.yaml",children:(0,l.jsx)(s.code,{children:"slurm-iam-role-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates IAM role for Slurm HyperPod operations."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"SageMaker execution role"}),"\n",(0,l.jsx)(s.li,{children:"Policies for Slurm cluster management"}),"\n",(0,l.jsx)(s.li,{children:"Trust relationships for HyperPod service"}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"6-fsxstack---slurm-fsx-templateyaml",children:["6. FsxStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/slurm/cloudformation/slurm-fsx-template.yaml",children:(0,l.jsx)(s.code,{children:"slurm-fsx-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates FSx for Lustre file system for Slurm clusters."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"High-performance FSx for Lustre file system"}),"\n",(0,l.jsx)(s.li,{children:"Mount targets in private subnets"}),"\n",(0,l.jsx)(s.li,{children:"Security group rules for FSx access"}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"7-hyperpodclusterstack---slurm-hyperpod-cluster-templateyaml",children:["7. HyperPodClusterStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/slurm/cloudformation/slurm-hyperpod-cluster-template.yaml",children:(0,l.jsx)(s.code,{children:"slurm-hyperpod-cluster-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Creates the Slurm-based HyperPod cluster with up to 20 configurable instance groups."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"SageMaker HyperPod Cluster with Slurm orchestration"}),"\n",(0,l.jsx)(s.li,{children:"Controller nodes (head nodes)"}),"\n",(0,l.jsx)(s.li,{children:"Login nodes"}),"\n",(0,l.jsx)(s.li,{children:"Compute nodes (worker nodes)"}),"\n",(0,l.jsx)(s.li,{children:"Multiple instance group configurations"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Key Parameters:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"HyperPodClusterName"}),": Cluster name"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"NodeRecovery"}),": Automatic or Manual"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"InstanceGroupSettings1-20"}),": Up to 20 instance groups with:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Instance type and count"}),"\n",(0,l.jsx)(s.li,{children:"EBS volume configuration"}),"\n",(0,l.jsx)(s.li,{children:"Lifecycle script settings"}),"\n",(0,l.jsx)(s.li,{children:"Custom AMI options"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.h4,{id:"8-ssmstack---slurm-ssm-templateyaml",children:["8. SSMStack - ",(0,l.jsx)(s.a,{href:"https://github.com/aws/sagemaker-hyperpod-cluster-setup/blob/main/slurm/cloudformation/slurm-ssm-template.yaml",children:(0,l.jsx)(s.code,{children:"slurm-ssm-template.yaml"})})]}),"\n",(0,l.jsx)(s.p,{children:"Configures Systems Manager for cluster access and management."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Resources Created:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"SSM endpoints for private subnet access"}),"\n",(0,l.jsx)(s.li,{children:"IAM roles for SSM connectivity"}),"\n",(0,l.jsx)(s.li,{children:"Session Manager configuration"}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"manual-deployment-steps",children:"Manual Deployment Steps"}),"\n",(0,l.jsx)(s.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"IAM Role Creation"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"aws iam create-role \\\n    --role-name AmazonSagemakerExecutionRole \\\n    --assume-role-policy-document file://0.AmazonSageMakerClustersExecutionRoleTrustedEntities.json\n\naws iam create-policy \\\n    --policy-name AmazonSagemakerExecutionPolicy \\\n    --policy-document file://1.AmazonSageMakerClustersExecutionRolePolicy.json\n\nPOLICY=$(aws iam list-policies --query 'Policies[?PolicyName==`AmazonSagemakerExecutionPolicy`]' | jq '.[0].Arn' | tr -d '\"')\naws iam attach-role-policy \\\n    --role-name AmazonSagemakerExecutionRole \\\n    --policy-arn $POLICY\n"})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"S3 Bucket for Lifecycle Scripts"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"BUCKET=\"sagemaker-lifecycle-$(python3 -S -c 'import uuid; print(str(uuid.uuid4().hex)[:10])')\"\naws s3 mb s3://${BUCKET}\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"deployment-sequence",children:"Deployment Sequence"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Deploy VPC Stack"})," (if not using existing VPC)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Deploy FSx Lustre Stack"})," (optional, for shared storage)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Upload Lifecycle Scripts"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"aws s3 cp --recursive LifecycleScripts/base-config s3://${BUCKET}/LifecycleScripts/base-config\n"})}),"\n"]}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.strong,{children:"Deploy HyperPod Cluster"})}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,l.jsx)(s.h4,{id:"slurm-cluster-configuration",children:"Slurm Cluster Configuration"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-json",children:'[\n  {\n    "InstanceGroupName": "controller-machine",\n    "InstanceType": "ml.c5.xlarge",\n    "InstanceCount": 1,\n    "LifeCycleConfig": {\n      "SourceS3Uri": "s3://${BUCKET}/LifecycleScripts/base-config/",\n      "OnCreate": "on_create.sh"\n    },\n    "ExecutionRole": "${ROLE}",\n    "ThreadsPerCore": 1\n  },\n  {\n    "InstanceGroupName": "compute-nodes",\n    "InstanceType": "ml.trn1.32xlarge",\n    "InstanceCount": 4,\n    "LifeCycleConfig": {\n      "SourceS3Uri": "s3://${BUCKET}/LifecycleScripts/base-config/",\n      "OnCreate": "on_create.sh"\n    },\n    "ExecutionRole": "${ROLE}",\n    "ThreadsPerCore": 1\n  }\n]\n'})}),"\n",(0,l.jsx)(s.h4,{id:"vpc-configuration",children:"VPC Configuration"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-json",children:'{\n  "SecurityGroupIds": ["$SECURITY_GROUP"],\n  "Subnets": ["$SUBNET_ID"]\n}\n'})}),"\n",(0,l.jsx)(s.h2,{id:"lifecycle-scripts",children:"Lifecycle Scripts"}),"\n",(0,l.jsx)(s.p,{children:"CloudFormation deployments automatically handle lifecycle scripts that:"}),"\n",(0,l.jsx)(s.h3,{id:"for-slurm",children:"For Slurm"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Configure Slurm scheduler and accounting"}),"\n",(0,l.jsx)(s.li,{children:"Mount FSx Lustre file system"}),"\n",(0,l.jsx)(s.li,{children:"Install Docker, Enroot, and Pyxis"}),"\n",(0,l.jsx)(s.li,{children:"Set up user accounts and POSIX permissions"}),"\n",(0,l.jsx)(s.li,{children:"Configure EFA and networking"}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"for-eks",children:"For EKS"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Install HyperPod dependency Helm charts"}),"\n",(0,l.jsx)(s.li,{children:"Configure Kubernetes resources"}),"\n",(0,l.jsx)(s.li,{children:"Set up monitoring and logging"}),"\n",(0,l.jsx)(s.li,{children:"Configure EFA device plugins"}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Parameter Validation"}),": Always validate parameters before deployment"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Resource Naming"}),": Use consistent naming conventions with prefixes"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Security"}),": Review security group rules and IAM policies"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Monitoring"}),": Deploy observability stacks for production workloads"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Backup"}),": Use S3 for lifecycle script and configuration backup"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(s.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Stack Creation Fails"}),": Check CloudWatch logs for detailed error messages"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"aws logs describe-log-groups --log-group-name-prefix /aws/sagemaker/Clusters\n"})}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Resource Limits"}),": Verify service quotas for your instance types"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"aws service-quotas get-service-quota \\\n  --service-code sagemaker \\\n  --quota-code L-1194F6F1\n"})}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"VPC Configuration"}),": Ensure subnets are in correct availability zones with capacity"]}),"\n",(0,l.jsx)(s.h3,{id:"getting-help",children:"Getting Help"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Review CloudFormation events in the AWS Console"}),"\n",(0,l.jsxs)(s.li,{children:["Check ",(0,l.jsx)(s.a,{href:"https://github.com/aws-samples/awsome-distributed-training",children:"awsome-distributed-training repository"})," for updates"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"clean-up",children:"Clean Up"}),"\n",(0,l.jsx)(s.p,{children:"Delete stacks in reverse order of creation:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# Delete HyperPod cluster first\naws sagemaker delete-cluster --cluster-name ml-cluster\n\n# Then delete CloudFormation stacks\naws cloudformation delete-stack --stack-name hyperpod-cluster-stack\naws cloudformation delete-stack --stack-name fsx-lustre-stack\naws cloudformation delete-stack --stack-name vpc-stack\n"})}),"\n",(0,l.jsx)(s.p,{children:"The CloudFormation templates provide a robust, repeatable way to deploy SageMaker HyperPod infrastructure with AWS best practices built-in."})]})}function u(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>i,x:()=>a});var n=r(6540);const l={},t=n.createContext(l);function i(e){const s=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);